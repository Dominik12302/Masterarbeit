#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 2cm
\rightmargin 2cm
\bottommargin 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
README: matlab tools for EM time series
\end_layout

\begin_layout Date
M.
 Becken
\end_layout

\begin_layout Standard
04/28/14
\end_layout

\begin_layout Section*
Recent changes: 
\end_layout

\begin_layout Itemize
before 08.05.2014
\begin_inset Newline newline
\end_inset

The name of the afc files has been extended to include the actual time range
 the spectra cover.
 For very large data sets, it may be necessary to introduce a brake at some
 point to make the file size handable.
 To discriminate these output files, the time range is added in the central
 part of the filename.
\end_layout

\begin_layout Itemize
08.05.2014
\end_layout

\begin_deeper
\begin_layout Itemize
Introduced a possibility to access and change all public properties of an
 EMSpectra object through an EMTimeSeries object.
 This allows to modify settings for spectral estimation in batch mode.
 See section 3.4 for an example
\end_layout

\begin_layout Itemize
Added simple first diff.
 prewhitening as an option to EMSpectra
\end_layout

\end_deeper
\begin_layout Section
Overview
\end_layout

\begin_layout Standard
The package contains matlab tools to read time series data, to compute spectra
 and to perform robust estimation of linear and bi-linear transfer functions.
 The code is largely organized in matlab classes.
 A matlab class is a convenient way to organize and store information on
 data sets.
 A class defintion includes properties - in the appearance similar to the
 fields of structures, and methods - functions which are exclusively available
 for the objects derived from that class.
 A variable derived from a class is called object.
\end_layout

\begin_layout Standard
Class properties can be discriminated into public properties, private properties
 and dependent properties.
 Public properties are properties whose value can be changed from the command
 line or within a matlab script or function.
 The syntax is the same as when assigning a value to a field of a struct.
 However, the format of the value must match the format in the classe definition.
 The general syntax to assign a value to a public property is 
\end_layout

\begin_layout Standard

\family typewriter
>> obj.publicproperty = <value>;
\end_layout

\begin_layout Standard
Public properties are used to control some output of the methods, for instance
 by defining a channel, a sample range, etc.
 to be plotted by some plot method.
\end_layout

\begin_layout Standard
In contrast, private properties do not accept assignments.
 Their values are set during the initialization of an object.
 For example, header information contained in a data file is meaningfully
 stored in private properties.
\end_layout

\begin_layout Standard
Note, that both public and private properties are given default values during
 the construction of an object, such that a default object conatins valid
 values.
\end_layout

\begin_layout Standard
Dependent properties are derived from other properties of the class.
 In fact, each dependent property is defined as a method (namely the get.method,
 a special function type) of other properties.
 Invoking a dependent property with the command
\end_layout

\begin_layout Standard

\family typewriter
>> value = obj.publicproperty;
\end_layout

\begin_layout Standard
triggers a function call every time it is called.
 This has the great advantage that dependent properties are always up-to-date,
 when some of the other properties are changed.
 The dis-adavantage is that computations may be re-performed even if not
 necessary.
 
\end_layout

\begin_layout Standard
An example usage of a class is as follows;
\end_layout

\begin_layout Standard

\family typewriter
>> obj = ClassName(<filename>); 
\family default
% generate an object of type ClassName to work with data in file <filename>
\end_layout

\begin_layout Standard

\family typewriter
>> obj.privateproperty_i = <value>; 
\family default
% set some property to some value
\end_layout

\begin_layout Standard

\family typewriter
>> output = obj.dependentproperty_j; 
\family default
% retrieve output dependentproperty_j that dependes on the value of some
 private properties, e.g.
 obj.privateproperty_i
\end_layout

\begin_layout Standard

\family typewriter
>> output = method_k(obj,varargin); 
\family default
% invoke some method, e.g.
 plotting etc.
\end_layout

\begin_layout Standard
A special method is, among others, the display method.
 Typing the name of a variable on the command line ususally returns its
 value in the matlab command window.
 This behavior is actually defined by the display method.
 If a display method is defined, typing the name of the object will thus
 produce some formatted output on the command window.
\end_layout

\begin_layout Standard
The available classes in this package and their main purposes include
\end_layout

\begin_layout Itemize

\family typewriter
EDEs:
\family default
 Read, resample, convert and plot EDE data for a single run
\end_layout

\begin_layout Itemize

\family typewriter
ADUs:
\family default
 Read, resample and plot ADU data for a single run
\end_layout

\begin_layout Itemize

\family typewriter
EMSpectra:
\family default
 Compute, write, read and plot spectra
\end_layout

\begin_layout Itemize

\family typewriter
EMRobustProcessing:
\family default
 Robust linear and bi-linear transfer function estimation
\end_layout

\begin_layout Itemize

\family typewriter
EMTimeSeries:
\family default
 Organize time series data for multiple stations, runs and sampling rates,
 and perform batch mode operations for time series and spectral estimation.
 Combines 
\family typewriter
EDEs
\family default
/
\family typewriter
ADUs
\family default
 and 
\family typewriter
EMSpectra
\family default
.
\end_layout

\begin_layout Itemize

\family typewriter
EMProc:
\family default
 Organize spectral data for multiple stations, runs and sampling rates,
 and perform batch mode robust processing for local and interstation transfer
 functions.
 Combines 
\family typewriter
EMSpectra
\family default
 and 
\family typewriter
EMRobustProcessing
\family default
.
\end_layout

\begin_layout Section
Annotated examples
\end_layout

\begin_layout Subsection
Reading ADU data
\end_layout

\begin_layout Standard
We first read the header information of the ADU data for one run, stored
 into a single or into multiple contigous files
\end_layout

\begin_layout Standard

\family typewriter
>> pathname = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
adc
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00'; 
\family default
% path where the data reside
\end_layout

\begin_layout Standard

\family typewriter
>> adu = ADUs; 
\family default
% generate default ADUs object
\end_layout

\begin_layout Standard

\family typewriter
>> adu.name = 'A02'; 
\family default
% add information about the sitename 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.run = '001'; 
\family default
% add information about the run label
\end_layout

\begin_layout Standard

\family typewriter
>> adu = ADUs(adu,pathname); 
\family default
% read the header information into the ADUs object
\end_layout

\begin_layout Standard
Now, everything about the data is known, You can extract some information
 about the recording by invoking the display method:
\end_layout

\begin_layout Standard

\family typewriter
>> adu
\end_layout

\begin_layout Standard
This will produce the following output in the command window:
\end_layout

\begin_layout Standard

\family typewriter
+ Station details for site A02 - run 000: 
\end_layout

\begin_layout Standard

\family typewriter
System: ADU07e 346 
\end_layout

\begin_layout Standard

\family typewriter
Latitude: 52.820953° 
\end_layout

\begin_layout Standard

\family typewriter
Longitude: 6.515902° 
\end_layout

\begin_layout Standard

\family typewriter
Sampling rate 512 Hz 
\end_layout

\begin_layout Standard

\family typewriter
Start or recording: 21-Mar-2014 11:26:00 + 000.0000 ms (1st sample) 
\end_layout

\begin_layout Standard

\family typewriter
Stop or recording: 23-Mar-2014 10:19:59 + 998.0469 ms (last sample) 
\end_layout

\begin_layout Standard

\family typewriter
Channel 1: Ex dipole 63.6 (m) 
\end_layout

\begin_layout Standard

\family typewriter
Channel 2: Ey dipole 65.6 (m) 
\end_layout

\begin_layout Standard

\family typewriter
Channel 3: Bx MFS06e mag.
 #450 
\end_layout

\begin_layout Standard

\family typewriter
Channel 4: By MFS06e mag.
 #451
\end_layout

\begin_layout Standard
So far, none of the actual time series have been read; only the header informati
on.
 To read the data, you may want to look at a particular time window, at
 particular channels.
\end_layout

\begin_layout Standard

\family typewriter
>> usetime = [2014 03 22 00 00 00 2014 03 22 12 00 00];
\family default
 % we look at 12 hours, from midnight to noon 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.usesmp = get_usesmp(adu,usetime); 
\family default
% it is more practical to provide this information in terms of samples rarther
 than in terms of times 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.reftime = [2014 03 21 00 00 00];
\family default
 % for plotting, and for some internal computations, we choose this as a
 reference time; it is close before the survey 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.usech = [1 2]; 
\family default
% we just want to plot the first two channels
\family typewriter
 
\end_layout

\begin_layout Standard

\family typewriter
>> data = adu.dataphys; 
\family default
% Now we can read the data for the given time interval and the given channel.
 Here, we read the data rescaled to physical units.

\family typewriter
 
\end_layout

\begin_layout Standard
Perhaps, we prefer to resample data for some reason before producing some
 output:
\end_layout

\begin_layout Standard

\family typewriter
>> adu.resmpfreq = 8; 
\family default
% to resample to 8 Hz 
\end_layout

\begin_layout Standard

\family typewriter
>> data = adu.dataphys; 
\family default
% Now, we obtain the data resampled at 8 HZ.
\end_layout

\begin_layout Standard
Instead of assigning the data to a variable, we can directly invoke the
 plot method to look at the data:
\end_layout

\begin_layout Standard

\family typewriter
>> hax = plot(adu,'time','relative h','units','physical','factor',[1 -1],'color'
,'k'); 
\end_layout

\begin_layout Standard
In this example, the data are plotted in physical units, the time axis is
 in hours relative to reftime, and the second channel is multiplied by -1
 before plotting.
 The call returns an array of axes handles.
 The produced graph is depicted as a black line in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_ts"

\end_inset

.
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename adu_ts_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_ts"

\end_inset

 Time series recorded with an ADU system at 512 Hz and resampled to 8Hz.
 12 hours are shown; the time axis is relative to the reference time.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Reading EDE data
\end_layout

\begin_layout Standard
The handling of EDE data is almost identical to that of ADU data.
 We first read the header information of the EDE data for one run, stored
 into a single or into multiple contigous files:
\end_layout

\begin_layout Standard

\family typewriter
>> pathname = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
adc
\backslash
EDE
\backslash
run2'; % path where the data reside
\end_layout

\begin_layout Standard

\family typewriter
>> ede = EDEs; % generate default EDEs object
\end_layout

\begin_layout Standard

\family typewriter
>> ede.name = 'A02'; % add information about the sitename 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.run = '002'; % add information about the run label
\end_layout

\begin_layout Standard

\family typewriter
>> ede = EDEs(ede,pathname); % read the header information into the EDEs
 object
\end_layout

\begin_layout Standard
Now, everything about the data is known.
 You can extract some information about the recording by invoking the display
 method:
\end_layout

\begin_layout Standard

\family typewriter
>> ede
\end_layout

\begin_layout Standard
This will produce the following output in the command window:
\end_layout

\begin_layout Standard

\family typewriter
+ Station details for site A02 - run 000: 
\end_layout

\begin_layout Standard

\family typewriter
System: EDE 001 
\end_layout

\begin_layout Standard

\family typewriter
Latitude: 52.820939° 
\end_layout

\begin_layout Standard

\family typewriter
Longitude: 6.515931° 
\end_layout

\begin_layout Standard

\family typewriter
Sampling rate 500 Hz 
\end_layout

\begin_layout Standard

\family typewriter
Start or recording: 21-Mar-2014 17:09:59 + 998.0000 ms (1st sample)
\end_layout

\begin_layout Standard

\family typewriter
Stop or recording: 22-Mar-2014 11:06:34 + 940.0000 ms (last sample)
\end_layout

\begin_layout Standard

\family typewriter
PPS Delay: 80.30 us
\end_layout

\begin_layout Standard

\family typewriter
Channel 1: Ex dipole 63.6 (m) 
\end_layout

\begin_layout Standard

\family typewriter
Channel 2: Ey dipole 65.6 (m) 
\end_layout

\begin_layout Standard
Next, we want to plot the data for the same time window as we did before
 for the ADU data.
 The syntax is the same as before:
\end_layout

\begin_layout Standard

\family typewriter
>> ede.usesmp = get_usesmp(ede,usetime); 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.reftime = [2014 03 21 00 00 00]; 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.resmpfreq = 8;
\end_layout

\begin_layout Standard

\family typewriter
>> hax = plot(ede,'time','relative h','units','physical','color','k','axes',hax)
; 
\end_layout

\begin_layout Standard
Note that we provide the axes handles of the axes produced before to enable
 plotting into the same axes.
 The updated graph is depicted in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_ts2"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename adu_ede_ts_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_ts2"

\end_inset

 Time series recorded with an ADU system (black line) at 512 Hz and an EDE
 system (black line) at 500 Hz, both resampled to 8 Hz.
 12 hours are shown; the time axis is relative to the reference time.
 Note that the ede recording was stopped before the the end of the plotted
 time interval.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Converting EDE data into ats format
\end_layout

\begin_layout Standard
EDE data can be converted into the ADU 
\family typewriter
*.ats
\family default
 format.
 While the 
\family typewriter
*.ats
\family default
 files are written with a complete header, the xml-file is not produced.
 Since the ADU and EDE work on different sampling rates, a resampling will
 typically be desired before format conversion.
 An example code is as follows:
\end_layout

\begin_layout Standard

\family typewriter
>> pathname = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
adc
\backslash
EDE
\backslash
run2'; 
\family default
% path where the data reside
\end_layout

\begin_layout Standard

\family typewriter
>> ede = EDEs; 
\family default
% generate default EDEs object
\end_layout

\begin_layout Standard

\family typewriter
>> ede.name = 'A02'; 
\family default
% add information about the sitename 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.run = '002'; 
\family default
% add information about the run label
\end_layout

\begin_layout Standard

\family typewriter
>> ede = EDEs(ede,pathname); 
\family default
% read the header information into the EDEs object
\end_layout

\begin_layout Standard

\family typewriter
>> ede.usesmp = [1 ede.Nsmp]; 
\family default
% use all samples, but first and last samples will be omitted to make sure
 that we start (and stop) at a full second; Note that you can also extract
 a limited range of samples here.
 The *.ats filed will be corespondingly short
\end_layout

\begin_layout Standard

\family typewriter
>> ede.usech = [1 2]; 
\family default
% output the two channels 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.reftime = reftime; 
\family default
% not very relevant for this 
\end_layout

\begin_layout Standard

\family typewriter
>> ede.resmpfreq = 512; 
\family default
% do resampling, can be anything >= 1 (Hz)
\end_layout

\begin_layout Standard

\family typewriter
>> ede.atsoutdir = {'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
proc
\backslash
EDE
\backslash
run2'}; 
\family default
% this is the output directory for storing the 
\family typewriter
*.ats
\family default
-files ; the naming convention for *.ats files follows that used for the
 ADU data.
 If this property is not set, the default is to write the data into the
 same directory where the original EDE files reside
\end_layout

\begin_layout Standard
Now, we are ready to do the actual resmapling and conversion.
 This is simply triggered by the following command
\end_layout

\begin_layout Standard

\family typewriter
>> atsfiles = ede.atsfile; 
\family default
% Invoking the atsfile property triggers exporting the data into *.ats format,
 with the names of the atsfiles returned in a cell array.
 The naming convention of the converted files follows that of the ADU system.
 In this example, the output file names are found from
\end_layout

\begin_layout Standard

\family typewriter
>> atsfiles'
\end_layout

\begin_layout Standard

\family typewriter
ans = 
\end_layout

\begin_layout Standard

\family typewriter
'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
proc
\backslash
EDE
\backslash
run2
\backslash
001_EDE_C01_R002_TEx_BL_512H.ats' 
\end_layout

\begin_layout Standard

\family typewriter
'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
proc
\backslash
EDE
\backslash
run2
\backslash
001_EDE_C02_R002_TEy_BL_512H.ats'
\end_layout

\begin_layout Standard
Note that the data are read, resampled and written seuqentially, so that
 there should be no memory problems, even with large data sets.
 To make sure that resampling operations to not introduce artefacts at the
 borders of each of the read intervals, we read actually some more data
 (exactly one second) before and after each time intervall, resample and
 cut out the relevant portion of the data.
 
\end_layout

\begin_layout Standard
Now the data should be readable with the ADUs class, e.g.
\end_layout

\begin_layout Standard

\family typewriter
>> obj = ADUs('D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
proc
\backslash
');
\end_layout

\begin_layout Standard
See the example codes that this really works.
\end_layout

\begin_layout Subsection
Computing spectra
\end_layout

\begin_layout Standard
Spectrograms are computed in a cascade fashion similar to that used in Egbert's
 EMTF code.
 The default definition of the the cascade decimation scheme involves seven
 decimation levels, with sampling rates being reduced by a factor 4 between
 two adjacent decimation levels.
 For each decimation levels, a short window fourier transform is employed,
 with wondow lengths of 128 samples and window overlaps of 32 samples.
 The default window for windowing is a dpss window.
 Other options (
\series bold
to be implemented
\series default
) include pre-whitening and delay filtering of the time series prior to
 fourier transformation.
 After spectral estimation, and before wrting the data to disk, the spectra
 are multiplied with the calibration functions for sensors and hardware.
 The spectrograms are computed for each channel separately.
 At present, it was more efficient (and convenient) to read the data for
 one channel completely before enetering the decimation scheme.
 If the time series is too long, you may run into memeory problems.
 This might be changed in future.
 Output format is 
\family typewriter
*.afc
\family default
.
 See the (
\series bold
uncomplete
\series default
) format decription at the end of the documentation.
\end_layout

\begin_layout Standard
All parameters above are properties of the EMSpectra class, which is used
 to compute, store and read spectrograms.
 Modify these settings to your needs, and refer to the detailed class descriptio
n of EMSpectra, given in the appendix.
 Here, I just provide a short example code to demonstrate the usage:
\end_layout

\begin_layout Standard
Let us use the ADU data from above:
\end_layout

\begin_layout Standard

\family typewriter
>> pathname = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
ts
\backslash
adc
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00'; 
\family default
% path where the data reside
\end_layout

\begin_layout Standard

\family typewriter
>> adu = ADUs; 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.name = 'A02'; 
\end_layout

\begin_layout Standard

\family typewriter
>> adu.run = '001'; 
\end_layout

\begin_layout Standard

\family typewriter
>> adu = ADUs(adu,pathname);
\end_layout

\begin_layout Standard

\family typewriter
>> adu.usesmp = [1 adu.Nsmp]; 
\family default
% Let us use all data
\end_layout

\begin_layout Standard
We do specify the channels to be used, which means that we want to use all
 channels.
 Now, let us create an EMSpectra object:
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra; 
\end_layout

\begin_layout Standard

\family typewriter
>> sp.reftime = reftime; 
\family default
% Very importatnt to choose a common referernce time for the entire survey;
 this setting will internally overwrite the value of the reftime property
 in the ADUs/EDEs object
\end_layout

\begin_layout Standard

\family typewriter
>> sp.source = {'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd'}; 
\family default
% this is the path where the 
\family typewriter
*.afc
\family default
 file is written to.
 Do not be confused that the properties name is 'source' rather then destination.
 This is because the EMSpectra object is also used to access the data in
 the afc file; then this will be the source file :-).
 Note further that, after succesful computation of the spectra, the value
 of sp.source will be complemented with the output filename.
\end_layout

\begin_layout Standard
Otherwise we use the default settings.
 Calling the EMSpectra class definition with an ADUs/EDEs time series object
 as the second argument triggers the computation of the spectrograms; EMSpectra
 reads the data from the time series object, performs the spectral computation,
 calibration and write the data to disk.
 
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra(sp,adu);
\end_layout

\begin_layout Standard
The naming convention is as self-explanatory and as follows:
\end_layout

\begin_layout Standard

\family typewriter
>> sp.source
\end_layout

\begin_layout Standard

\family typewriter
ans = 
\end_layout

\begin_layout Standard

\family typewriter
'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00
\backslash
346_ADU_R001_TExEyBxBy_512H_Z20140321-000000.afc'
\end_layout

\begin_layout Standard
Note that we include the system and the reftime in the filename.
\end_layout

\begin_layout Standard
In the above, we have not provided any information about calibration data.
 In this case, theoretical transfer functions for coils, as well as for
 the EDE systems are built-in.
 Coil transfer functions can be computed if the code recognizes the sensor
 (currently basically the metronix coils) or the system (currently only
 the EDE).
 However, this can in the end not replace using individual sensor/system
 calibration files.
 If these are available, provide the path to these calibration data before
 computing the spectra, e.g.
\end_layout

\begin_layout Standard

\family typewriter
>> sp.caldir = {'D:
\backslash
DCtrain
\backslash
s'};
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra(sp,adu);
\end_layout

\begin_layout Standard
If the format of calibration files is recognized, they are read and used;
 otherwise the theoretical transfer functions are used.
 If nothing is recognized, e.g.
 unknown sensor, etc.
 then a unity transfer function is used for the respective channel.
\end_layout

\begin_layout Standard
Now, the EMSpectra object provides access to the fourier coeffcients, as
 would be an EMSpectra object that is initialized by reading an already
 existing *.afc file (next section).
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status collapsed

\begin_layout Plain Layout

\emph on
The EMSpectra class is designed to make no difference between different
 kinds of time series objects (e.g.
 ADUs or EDEs), so that the above example should work equally well with
 an EDEs object.
 Note that the resampled time series are used for spectral estimation, if
 resampling had been requested in the time series object.
 This would make it obsolete to perform format conversion of EDE into ADU
 data prior to spectral estimation.
 However, this has only been tested to the degree that the code produced
 some error, and the cause of the error has not yet been traced.
 Therefore, at the moment, the procedure would be to first resample the
 EDE data and convert them to *.ats format, and then perform the spectral
 computation on the correspondinf ADUs object (providing acces to either
 original ADU data or to converted EDE data).
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Reading spectra
\end_layout

\begin_layout Standard
The EMSpectra class is also used to read existing afc files.
 For example the above created file will can be read as follows:
\end_layout

\begin_layout Standard

\family typewriter
>> filename = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00
\backslash
...
\begin_inset Newline newline
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

346_ADU_R001_TExEyBxBy_512H_Z20140321-000000.afc';
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra(filename);
\end_layout

\begin_layout Standard
The EMSpectra object should now be identical to the one created above.
 
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status collapsed

\begin_layout Plain Layout

\emph on
In practice, there is still some information missing in the header of the
 *.afc file such as the name of the calibration files and the calibration
 data
\emph default
.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The display method outputs some basic information about the file:
\end_layout

\begin_layout Standard

\family typewriter
>> sp % this should produce the following response:
\end_layout

\begin_layout Standard

\family typewriter
+ Station details for site A02 - run 001: 
\end_layout

\begin_layout Standard

\family typewriter
Latitude: 52.820953° 
\end_layout

\begin_layout Standard

\family typewriter
Longitude: 6.515902° 
\end_layout

\begin_layout Standard

\family typewriter
Sampling rate: 512 Hz 
\end_layout

\begin_layout Standard

\family typewriter
First | last window: 21-Mar-2014 11:26:00 | 23-Mar-2014 10:19:59 
\end_layout

\begin_layout Standard

\family typewriter
Reference time: 21-Mar-2014 00:00:00 
\end_layout

\begin_layout Standard

\family typewriter
4 channels: Ex, Ey, Bx, By 
\end_layout

\begin_layout Standard

\family typewriter
7 decimation levels: 512 Hz | 128 Hz | 32 Hz | 8 Hz | 2 Hz | 2 sec | 8 sec
\end_layout

\begin_layout Subsection
Extracting fourier coefficients and plotting spectra
\end_layout

\begin_layout Standard
There are a number of switches to select particular channels, decimation
 levels, range of fourier coefficients and range frequencies to be read
 from file.
 Here, I provide an example, how to plot the autopower on one channel
\end_layout

\begin_layout Standard
First.
 load the data:
\end_layout

\begin_layout Standard

\family typewriter
>> filename = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00
\backslash
...
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

346_ADU_R001_TExEyBxBy_512H_Z20140321-000000.afc';
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra(filename);
\end_layout

\begin_layout Standard
We are interested to look at decimation level, say, 6
\end_layout

\begin_layout Standard

\family typewriter
>> sp.usedec = 6;
\end_layout

\begin_layout Standard
Next, we specfiy a range of frequencies.
 Overall, with the current setting, we have 65 fourier coefficients at decimatio
n level 6 (cf.
 
\family typewriter
sp.Nf
\family default
), but want to truncate the first 4 coefficients.
\end_layout

\begin_layout Standard

\family typewriter
>> sp.fcrange = [4 65];
\end_layout

\begin_layout Standard
We could also specify the range of sets (windows), but for now we decide
 to plot the entire data set.
 So we leave the sp.setrange property empty.
\end_layout

\begin_layout Standard
The plot method forms the autopower.
 
\end_layout

\begin_layout Standard

\family typewriter
>> plot(sp,'channel','Ex','time','utc','clim',[-10 -2],'frequency','Hz');
 
\end_layout

\begin_layout Standard
The variable parameters request to plot Ex on an utc time axis, with the
 color axis in the range
\end_layout

\begin_layout Standard
Now, the output channel data can be read from file with these settings:
\end_layout

\begin_layout Standard

\family typewriter
>> Y = sp.Y; 
\family default
% returns the complex fourier coeffcients for two channels, 61 coefficients
 and all sets.
\end_layout

\begin_layout Standard
Next, we wish to compare the spectra for the ADU and EDE recordings.
 We thus repeat the above procedure for both and extract the overlapping
 time windows.
\end_layout

\begin_layout Standard

\family typewriter
filename = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd
\backslash
EDE
\backslash
run2
\backslash
...
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space \space{}
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

001_EDE_R002_TExEy_512H_Z20140321-000000.afc'; 
\family default
% EDE spectra
\end_layout

\begin_layout Standard

\family typewriter
spe = EMSpectra(filename); 
\end_layout

\begin_layout Standard

\family typewriter
spe.output = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
spe.usedec = 6;
\end_layout

\begin_layout Standard

\family typewriter
filename = 'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd
\backslash
ADU
\backslash
meas_2014-03-21_11-26-00
\backslash
...
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

346_ADU_R001_TExEyBxBy_512H_Z20140321-000000.afc'; 
\family default
% ADU spectra
\end_layout

\begin_layout Standard

\family typewriter
spa = EMSpectra(filename); 
\end_layout

\begin_layout Standard

\family typewriter
spa.output = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
spa.usedec = 6;
\end_layout

\begin_layout Standard
% Find the matching sets (time windows) with the intersect command by comparing
 the window index vectors relative to reftime
\end_layout

\begin_layout Standard

\family typewriter
[a,b,c]=intersect(spa.wr,spe.wr); 
\end_layout

\begin_layout Standard

\family typewriter
spa.setrange = b; 
\end_layout

\begin_layout Standard

\family typewriter
spe.setrange = c;
\end_layout

\begin_layout Standard

\family typewriter
spa.fcrange = [4 65]; 
\end_layout

\begin_layout Standard

\family typewriter
spe.fcrange = [4 65];
\end_layout

\begin_layout Standard

\family typewriter
plot(spa,'channel','Ex','time','utc','clim',[-10 -2],'frequency','Hz');
\end_layout

\begin_layout Standard

\family typewriter
plot(spe,'channel','Ex','time','utc','clim',[-10 -2],'frequency','Hz');
\end_layout

\begin_layout Standard
This produces the Figures in Figs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_spec1"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_spec2"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename spectra_adu_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_spec1"

\end_inset

 Ex-Spectrogram at decimation level 6 for the data recorded with an ADU
 system at 512 Hz.
 Only the portion of the data overlapping with one of the synchronous EDE
 recordings is shown.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename spectra_ede_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_spec2"

\end_inset

 Ex-Spectrogram at decimation level 6 for the data recorded with an EDE
 system at 500 Hz resampled to 512 Hz and stored as in ats format.
 Only the portion of the data overlapping with the synchronous ADU recording
 is shown.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Computing single-site transfer functions
\end_layout

\begin_layout Subsection
Computing inter-station transfer functions
\end_layout

\begin_layout Section
EMTimeSeries: Operating with time series in batch mode
\end_layout

\begin_layout Standard
The 
\family typewriter
EMTimeSeries
\family default
 object provides access to an entire survey consisting of multiples sites
 with multiple runs at multiple sampling rates.
 To achieve some degree of order, we require a particular directory structure
 as depicted inf Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_emts0"

\end_inset

a.
 A project consists of a number of sites, and each site is organized in
 a directory structure with subdirectories for time series, spectra and
 transfer functions.
 Each of these subdirectories may be structured further.
 For instance, we usually store the original time series (as they come from
 the AD converter) in a subdirectory 
\family typewriter
./adc/system,
\family default
 which also specifies the system type, e.g.
 
\family typewriter
./adc/EDE
\family default
, and with further subdirectories to organize individual runs, e.g.
 
\family typewriter
./adc/EDE/run*
\family default
/ or 
\family typewriter
./adc/ADU/meas*
\family default
/.
 Processed data (e.g.
 resampled and converted data may be output) in a corresponding subdirectory
 
\family typewriter
./proc/EDE/run*/
\family default
 (only EDE data in this version).
 
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename directory_structure.png
	lyxscale 50
	width 12cm

\end_inset


\end_layout

\begin_layout Plain Layout
\noindent
\align left
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_emts0"

\end_inset

 Directory structure used in the 
\family typewriter
EMTimeSeries
\family default
 class.
 
\series bold
a) 
\series default
The general directory structure is encoded i public properties of an 
\family typewriter
EMTimeSeries
\family default
 object.
\series bold
b)
\series default
 An example of a typical usage.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

The above path definitions are encoded in public fields of the 
\family typewriter
EMTimeSeries
\family default
 object and may be adopted to the individual needs.
 Fourier transformed data will be stored in the 
\family typewriter
./fc 
\family default
subdirectory.
\end_layout

\begin_layout Standard
Internally, ADUs, EDEs and EMSpectra objects are initialized 'on the fly'
 and the appropriate options are set automatically.
 See section 3.4 for how to access and modify the default settings for an
 EMSpectra object.
 
\end_layout

\begin_layout Subsection
Reading and plotting data and plotting runtimes
\end_layout

\begin_layout Standard
One of the main usage objectives of this class is to data quality control.
 A range of sites with multiple runs can therefore be read and accessed
 with a few lines of code.
 An example code is as follows:
\end_layout

\begin_layout Standard

\family typewriter
%% Example EM Time series 
\end_layout

\begin_layout Standard

\family typewriter
>> propath = {'E:
\backslash
DCtrain'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> reftime = [2014 03 21 0 0 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(reftime,propath); 
\family default
% Initialize the object; Note that reftime and propath can not be changed
 any more.
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(emts,{'E02' 'E03' 'E04' 'E05' 'E06' 'E07'}); 
\family default
% Read the data from the sites specified in the cell array
\end_layout

\begin_layout Standard

\family typewriter
>> plotruntimes(emts,'time','utc');
\family default
% Here, we have an overview abot the runtimes of the imported stations (cf.
 Fig.
 )
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_emts1"

\end_inset


\end_layout

\begin_layout Standard
Next, we specify some of the parameters which we wish to plot: time range,
 channels, sampling rate.
 We shall also distinguish between some site which we denote as the local
 site, and simultaneous recordings, which we shalle denote as the basesites.
\end_layout

\begin_layout Standard

\family typewriter
>> usetime = [2014 03 22 12 0 0 2014 03 22 13 0 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.usetime = usetime;
\end_layout

\begin_layout Standard

\family typewriter
>> emts.usech = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.lsname = {'E02'}; 
\family default
% this is to specfiy the local site
\end_layout

\begin_layout Standard

\family typewriter
>> emts.lsrate = 500; 
\family default
% among all sampling schemes recorded at the local site, we pick the recordings
 at 500 Hz
\end_layout

\begin_layout Standard

\family typewriter
>> emts.bsname = {'E03' 'E04' 'E05' 'E06' 'E07'}; 
\family default
% these are the base sites
\end_layout

\begin_layout Standard

\family typewriter
>> emts.bsrate = [500]; 
\family default
% for the base sites, we also pick the recordings at 500 Hz but this is
 not necessary.
 We can provide a vector of sampling rates, e.g.
 
\family typewriter
[500 512]
\end_layout

\begin_layout Standard

\family typewriter
>> emts.resmpfreq = 8; 
\family default
% for plotting, we will resample all data to 8Hz
\end_layout

\begin_layout Standard

\family typewriter
>> plot(emts,'time','utc','color','r'); 
\family default
% This will plot the data, using a red color for the local site, and a choice
 of colors for all base sites (cf.
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_emts2"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename emts_runtimes_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_emts1"

\end_inset

 Run times for six sites.
 Run numbers are superposed on the bars.
 Time axis is labelled in utc time
\end_layout

\end_inset

T
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename emts_timeseries_example.eps
	width 15cm

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_emts2"

\end_inset

 Time series recorded with the six different EDE systems at 500 Hz resampled
 to 8 Hz.
 1 hour is shown; the time axis is in utc time.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Converting data
\end_layout

\begin_layout Standard
It may be necessary and convenient to resample and convert EDE data into
 *.ats format in batch mode.
 Here is an example code of how to accomplish this.
 In this example, all runs from the current local site are converted.
 If the usetime property is not set, then all data are used.
 Note that it is not necessary to define the base sites in this case.
 A simple loop over all stations would convert all sites.
 Note further that at present, data conversion will only work on ede data.
 Trying to apply this to adu data will most likely produce an error.
 
\end_layout

\begin_layout Standard

\family typewriter
%% Example EM Time series: convert local site data into ats format resampled
 to 512 Hz 
\end_layout

\begin_layout Standard

\family typewriter
>> propath = {'E:
\backslash
DCtrain'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> reftime = [2014 03 21 0 0 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(reftime,propath); 
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(emts,{'E02' 'E03' 'E04' 'E05' 'E06' 'E07'}); 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.usech = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.lsrate = 500; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.resmpfreq = 512; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.lsname = {'E02'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> atsfiles = emts.atsfiles;
\end_layout

\begin_layout Standard
The converted data will be stored in the subdirectory structure of obj.propath,
 e.g.
 or 
\family typewriter
./proc/EDE/run*
\family default
/.
 A simple for loop, such as 
\end_layout

\begin_layout Standard

\family typewriter
>> for is = 1:numel(emts.sites) 
\end_layout

\begin_layout Standard

\family typewriter
>> 
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

emts.lsname = emts.sites(is); 
\end_layout

\begin_layout Standard

\family typewriter
>> 
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

atsfiles = emts.atsfiles; 
\end_layout

\begin_layout Standard

\family typewriter
>>end
\end_layout

\begin_layout Standard
does the same sequentially for all stations.
\end_layout

\begin_layout Subsection
Computing spectra and storing them to file
\end_layout

\begin_layout Standard
In a similar way, spectra can be computed and stored in batch mode.
 
\end_layout

\begin_layout Standard

\family typewriter
%% Example EM Time series: Compute spectra of converted EDE and ADU data
 
\end_layout

\begin_layout Standard

\family typewriter
>> propath = {'E:
\backslash
DCtrain'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> reftime = [2014 03 21 0 0 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(reftime,propath); 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.datapath = {'./proc/EDE/run*' './adc/ADU/meas*'};
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(emts,{'E02' 'E03' 'E04' 'E05' 'E06' 'E07'}); 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.usech = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.lsrate = 512; 
\end_layout

\begin_layout Standard

\family typewriter
>> afcfiles = emts.afcfiles;
\end_layout

\begin_layout Standard
The converted data will be stored in the subdirectory structure of obj.propath,
 e.g.
 or 
\family typewriter
./fc/EDE/run*
\family default
/.
 A simple for loop, such as 
\end_layout

\begin_layout Standard

\family typewriter
>> for is = 1:numel(emts.sites) 
\end_layout

\begin_layout Standard

\family typewriter
>> 
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

emts.lsname = emts.sites(is); 
\end_layout

\begin_layout Standard

\family typewriter
>> 
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

afcfiles{is} = emts.afcfiles; 
\end_layout

\begin_layout Standard

\family typewriter
>>end
\end_layout

\begin_layout Standard
does the same sequentially for all stations.
\end_layout

\begin_layout Standard
Some data sets may be too large to be handled conveniently.
 To breal one large data set int a range of spectra files, invoke the usetime
 property as follows:
\end_layout

\begin_layout Standard

\family typewriter
usetime = {[2014 3 21 00 00 00 2014 3 24 00 00 00] ...
 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

[2014 3 24 00 00 00 2014 3 27 00 00 00] ...
 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

[2014 3 27 00 00 00 2014 3 30 00 00 00] ...
 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

[2014 3 30 00 00 00 2014 4 02 00 00 00]}; 
\end_layout

\begin_layout Standard

\family typewriter
for is = 1:numel(emts.sites) 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

for iuse = 1:numel(usetime) 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

emts.usetime = usetime{iuse}; 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

emts.lsname = emts.sites(is); 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

afcfiles = emts.afcfiles; 
\end_layout

\begin_layout Standard

\family typewriter
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

end 
\end_layout

\begin_layout Standard

\family typewriter
end
\end_layout

\begin_layout Standard
Here, we broke the survey time into pieces of three days.
 This will result in smaller file sizes, at the expense that at we may omit
 1 or 2 spectra sets (time windows) at each breal and at each decimation
 level.
\end_layout

\begin_layout Subsection
Changing default properties of 
\family typewriter
EMSpectra
\family default
 objects 
\end_layout

\begin_layout Standard
There is a possibility to pass values to an EMSpectra objects through an
 EMTimeSeries object via the EMTimeSeries property spdef.
 obj.spdef is either emtpy (default) or a struct with fields which are passed
 to an EMSpectra object.
 Therefore field names must be valid public properties of the EMSpectra
 class.
 If not, they are ignored (without issuing a warning).
 spdef may cintain an arbitrary number of valid fields.
 Here is an example, how to modify, for instance the decimation scheme for
 spectral computation.
\end_layout

\begin_layout Standard

\family typewriter
%% Example EM Time series: Compute spectra of ADU data with a modified decimatio
n scheme
\end_layout

\begin_layout Standard

\family typewriter
>> propath = {'E:
\backslash
DCtrain'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> reftime = [2014 03 21 0 0 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(reftime,propath); 
\end_layout

\begin_layout Standard

\family typewriter
>> emts.datapath = {'./proc/EDE/run*' './adc/ADU/meas*'};
\end_layout

\begin_layout Standard

\family typewriter
>> emts = EMTimeSeries(emts,{'E02' 'E03' 'E04' 'E05' 'E06' 'E07'}); 
\end_layout

\begin_layout Standard

\family typewriter
%% Example EM Time series: Compute spectra of converted EDE and ADU data
 
\end_layout

\begin_layout Standard

\family typewriter
>> spdef.Ndec = 5;
\end_layout

\begin_layout Standard

\family typewriter
>> spdef.wlength = [512 512 512 128 128];
\end_layout

\begin_layout Standard

\family typewriter
>> spdef.noverlap = [128 128 128 64 64];
\end_layout

\begin_layout Standard

\family typewriter
>> spdef.prew = [-1 -1 -1 -1 -1];
\end_layout

\begin_layout Standard

\family typewriter
>> ...
\end_layout

\begin_layout Standard

\family typewriter
>> emts.spdef = spdef;
\end_layout

\begin_layout Standard

\family typewriter
>> ...
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
appendix
\end_layout

\end_inset


\end_layout

\begin_layout Section

\family typewriter
EMProc
\family default
: Operating with spectra files in batch mode
\end_layout

\begin_layout Subsection
Computing transfer functions
\end_layout

\begin_layout Standard

\family typewriter
% Example code
\end_layout

\begin_layout Standard

\family typewriter
>> projectname = {'G:
\backslash
DCTrain'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc = EMProc(projectname); 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.datapath = {'EDE
\backslash
run*'}; 
\end_layout

\begin_layout Standard
Load all spectra files for some stations:
\end_layout

\begin_layout Standard

\family typewriter
>> proc = EMProc(proc,{'E01' 'E03','E05','E06'}); 
\end_layout

\begin_layout Standard
We will compute electric interstation transfer functions; Define input and
 output channels accordingly:
\end_layout

\begin_layout Standard

\family typewriter
>> proc.input = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.output = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard
We need a rule which fourier coefficients to combine into one estimation
 frequency.
 A default setup (bandsetup) is to use two target frequencies per decade.
 The averaging rules are automatically determined for the given window lengths/d
ecimation levels etc.
\end_layout

\begin_layout Standard

\family typewriter
>> proc.bandsetup = 'MT'; 
\end_layout

\begin_layout Standard
We take the input channels from the base site and the output channels from
 the local site: Define these and also define the original samplingrate
 to use
\end_layout

\begin_layout Standard

\family typewriter
>> proc.lsrate = 512; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.bsrate = 512; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.bsname = {'E03'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.lsname = {'E05'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.usetime = []; % leave empty: use all avaible data (default)
\end_layout

\begin_layout Standard
Next, we can pass some options to the EMRobustProcessing routine: These
 are combined in the procdef property.
\end_layout

\begin_layout Standard

\family typewriter
>> procdef.avrange = [10 2]; % averaging domain Nfc x Nsets for smoothing
 of spectral matrics; this imparts on the coherency estimation, polarization
 props.
 etc.
 
\end_layout

\begin_layout Standard

\family typewriter
>> procdef.bicohthresg = {[0.9 1]}; % threshold fcs for which the coherency
 is estimated below 0.9
\end_layout

\begin_layout Standard

\family typewriter
>> proc.procdef = procdef; %% compute transfer functions for all data tfs
 = proc.tf; 
\end_layout

\begin_layout Standard
Now, we are ready to compute the transfer functions:
\end_layout

\begin_layout Standard

\family typewriter
>> tf = proc.tf;
\end_layout

\begin_layout Standard
The output is shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Transfer-function-estimates"

\end_inset

a.
\end_layout

\begin_layout Standard
Instead of using all data, we may consider only a subset by setting the
 usetime property.
 An example is as follows:
\end_layout

\begin_layout Standard

\family typewriter
>> proc.usetime = [2014 03 23 23 30 0 2014 03 24 00 00 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> tf = proc.tf; 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
a) 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
b)
\series default
 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename TF_E05_E03_one_day.eps
	width 7cm

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename TF_E05_E03_half_hour.eps
	width 7cm

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Transfer-function-estimates"

\end_inset

Transfer function estimates using 
\series bold
a)
\series default
 one day of data 
\series bold
b)
\series default
 half an hour of data.
\end_layout

\end_inset


\end_layout

\end_inset

This produces the output in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Transfer-function-estimates"

\end_inset

b.
\end_layout

\begin_layout Subsection
Computing coherency
\end_layout

\begin_layout Standard
We keep the settings as above, and compute the coherency between the input
 and output channels for all fourier coefficients at decimation level 
\end_layout

\begin_layout Standard

\family typewriter
% Example code
\end_layout

\begin_layout Standard

\family typewriter
>> proc.usetime = [2014 03 23 23 30 0 2014 03 24 00 00 0]; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.usedec = 4; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.fcrange = []; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.input = {'Ex' 'Ey'}; 
\end_layout

\begin_layout Standard

\family typewriter
>> proc.output = {'Ex'};
\end_layout

\begin_layout Standard
The coherency matrix is computed with the command
\end_layout

\begin_layout Standard

\family typewriter
>> coh = proc.coh;
\end_layout

\begin_layout Standard
To produce the image in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Bivariate-coherency"

\end_inset

, type 
\end_layout

\begin_layout Standard

\family typewriter
>> plotcoh(proc);
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename coherency.eps
	width 10cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Bivariate-coherency"

\end_inset

Bivariate coherency between local Ex and remote Ex and Ey channels for half
 an hour of data at decimation level.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Computing individual transfer functions
\end_layout

\begin_layout Standard

\family typewriter
% Example code
\end_layout

\begin_layout Standard
...
\end_layout

\begin_layout Subsection
Computing polarization properties
\end_layout

\begin_layout Standard
We keep the settings above and compute the polarization characteristics
 with the command:
\end_layout

\begin_layout Standard

\family typewriter
% Example code
\end_layout

\begin_layout Standard

\family typewriter
>> pol = proc.pol;
\end_layout

\begin_layout Standard
To produce the image in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Polarization"

\end_inset

, type 
\end_layout

\begin_layout Standard

\family typewriter
>> plotpol(proc):
\end_layout

\begin_layout Standard
instead.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
a) 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
b)
\series default
 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename poldegree.eps
	width 9cm

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Graphics
	filename polangle.eps
	width 9cm

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Polarization"

\end_inset

Polarization of the horizontal field at the base site, derived from an eigenvalu
e decomposition of the 
\begin_inset Formula $2\times2$
\end_inset

 spectral matrix.
 
\series bold
a)
\series default
 degree of polarization 
\series bold
b)
\series default
 polarization of the field at the base site for half an hour of data at
 decimation level 4.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Class 
\family typewriter
EMTimeSeries
\end_layout

\begin_layout Standard
An 
\family typewriter
EMTimeSeries
\family default
 object is used to organize an entire survey constituting of multiple sites,
 each with multiple recordings in various sampling rates.
 The class provides the following functionality:
\end_layout

\begin_layout Itemize
Plot tuntimes for a given sampling frequency or a given array of sampling
 rates
\end_layout

\begin_layout Itemize
Plot time series for given channels, given time window, given local site
 and a range of synchronously recorded base sites.
 This can handle time series of different sampling rates.
 Resampling to a given sampling rate is possible.
\end_layout

\begin_layout Itemize
Batch mode for resampling and storing in ats format 
\end_layout

\begin_layout Itemize
Batch mode for spectra computation 
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Standard

\family typewriter
obj = EMTimeSeries(<reftime>,<propath>); 
\family default
% set global reference time and project path
\end_layout

\begin_layout Standard

\family typewriter
obj = EMTimeSeries(obj,{'<site1>' '<site2>' ...}); 
\family default
% read data from site
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.propath {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.fcpath {'./fc'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tfpath {'./tf'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tspath {'./ts/'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.datapath {'./adc/EDE/run*','./adc/ADU/meas*'} 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.procpath= {'./proc'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.calpath {'../s'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.localsite {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.basesite {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.resmpfreq 0; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usetime []; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesites {'all'};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usech {'all'} | {'Ex' 'Ey' 'Bx' ...}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesrates []; % if empty, use all sampling rates; else provide array
 with numbers 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.spdef []; % settings for EMspectra object.
 if empty, default settings are used; otherwise you may pass a struct to
 spdef with fields whose names correspond to valid public properties of
 an EMSpectra object;
\begin_inset Newline newline
\end_inset

Example;
\begin_inset Newline newline
\end_inset

>> spdef.bandsetup = 'MT';
\begin_inset Newline newline
\end_inset

>> spdef.window = 'Hanning';
\begin_inset Newline newline
\end_inset

>> obj.spdef = spdef;
\begin_inset Newline newline
\end_inset

Then, these settings will be used for spectral estimation instead of the
 deault ones.
 See public properties of EMSpectra for a list of valid properties.
 Note that at the moment, the values in spdef are not tests for their validity
 ...
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel = 0 | 1 | 2; 
\end_layout

\begin_layout Subsection
Private properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.reftime 
\family default
global survey reference time.
 This property is inherited to als timeseries objects 
\family typewriter
(EDEs, ADUs)
\family default
 and remains therefore private.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sites
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
cell array with all station names
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.site
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
cell array collecting all time series objects
\family typewriter
 (EDEs, ADUs).

\family default
 The cell is organized as follows: 
\end_layout

\begin_layout Subsection
Dependent properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsind
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
index into local site.
 local time series objects are available from
\family typewriter
 obj.site{obj.lsind}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lNruns 
\family default
Number of runs (time series objects available) for local site 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrates 
\family default
sampling rates for each of the runs at the local site
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrateind 
\family default
index vector into runs of local site which match the requested sampling
 rate 
\family typewriter
obj.lsrate
\family default
.
 Time series objects of local site at this sampling rate are accessed with
 
\family typewriter
obj.site{obj.lsind}(obj.lsrateind)
\family default
 and returns a cell array with time series objects.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.locasite 
\family default
cell array with time series objects matching the current local site (
\family typewriter
obj.lsname
\family default
) at the current sampling rate (
\family typewriter
obj.lsrate
\family default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsind
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
index vector into base sites.
 Base site time series objects for the 
\family typewriter
ibs
\family default
-st base site are available from
\family typewriter
 obj.site{obj.bsind{ibs}}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bNruns 
\family default
vector with number of runs (time series objects available) for base sites
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsrates 
\family default
cell array of sampling rates at each base site and each run .
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsrateind 
\family default
cell array of index vectors into runs of base site which match one the requested
 sampling rates in 
\family typewriter
obj.bsrate
\family default
.
 Time series objects of base site at this particular sampling rate are accessed
 with 
\family typewriter
obj.site{obj.bsind{ibs}}(obj.lsrateind{ibs})
\family default
 and returns a cell array with time series objects.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.basesite 
\family default
cell array with time series objects matching one of the base sites (
\family typewriter
obj.bsname
\family default
) at the current sampling rates (
\family typewriter
obj.bsrate
\family default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsfiles 
\family default
triggers format conversion of local (
\family typewriter
lsname
\family default
) EDE data into 
\family typewriter
*.ats
\family default
 format for the given range of samples (derived from the 
\family typewriter
obj.usetime
\family default
 property), the given channels 
\family typewriter
obj.usech
\family default
 and the given sampling rate 
\family typewriter
obj.lsrate
\family default
.
 Data will be resampled, if 
\family typewriter
obj.resmpfreq
\family default
 ist set (i.e.
 
\family typewriter
> 0
\family default
)
\end_layout

\begin_layout Subsection
Methods
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj); 
\family default
Output some station details for the object
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

obj 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

display(obj); 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

str
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj);
\family default
 text output returned in a cell aray of strings (
\series bold
not completed
\series default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plotruntimes(obj,varargin) 
\family default
Plot time series for the time segment given by 
\family typewriter
obj.use
\family default
time.

\family typewriter
 varargin 
\family default
is a variable sequence of keywords followed by a valid value, 
\family typewriter
varargout
\family default
 returns an array of axes handles.
 The time series are plotted for the local site and all base sites.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Input
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'time',
\begin_inset space ~
\end_inset

value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of 
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'relative smp';
\family default
samples relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative s';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
seconds relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative h';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
hours relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative d';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
days relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'utc';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
UTC time
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments
\begin_inset space ~
\end_inset

(
\series bold
not
\begin_inset space ~
\end_inset

implemented
\series default
):
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax = plot(obj,varargin);
\family default
 returns the handles to the axes.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varagout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,varargin} 
\family default
Plot time series for the time segment given by 
\family typewriter
obj.use
\family default
time.
 
\family typewriter
varargin 
\family default
is a variable sequence of keywords followed by a valid value, 
\family typewriter
varargout
\family default
 returns an array of axes handles.
 The time series are plotted for the local site and all base sites.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Input
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'time',
\begin_inset space ~
\end_inset

value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of 
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'relative smp';
\family default
samples relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative s';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
seconds relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative h';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
hours relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative d';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
days relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'utc';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
UTC time
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'units',value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of
\begin_inset Newline newline
\end_inset


\family typewriter
value = 'int';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plots 
\family typewriter
obj.dataint
\family default
 as integer numbers without any conversion to physical units
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'mV';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data=obj.dataint*obj.lsb
\family default
 in 
\family typewriter
mV
\begin_inset Newline newline
\end_inset

value = 'physical';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data/obj.dipole 
\family default
in 
\family typewriter
mV/m
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'elim',value,
\family default
 axis scaling for electric field plots, in the scale of 
\family typewriter
'units';
\family default
 Default is auto scaling
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'color',
\begin_inset space ~
\end_inset

value 
\family default
color code for plotting, can be one of the valid matlab colors (e.g.
 'r', 'k', 'b' ,...) or a [r g b] vector.

\family typewriter
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'elim', value
\begin_inset Newline newline
\end_inset

value = [min max]; 
\family default
scales the electric field axes
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'axes', value
\begin_inset Newline newline
\end_inset

value = [hax1 hax2 ...]; 
\family default
plot the data into the existing axes
\family typewriter
 [hax1 hax2 ...]
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax = plot(obj,varargin);
\family default
 returns the handles to each axes.

\family typewriter
 
\family default
Dimension of 
\family typewriter
hax 
\family default
corresponds to dimension of 
\family typewriter
obj.usech
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Examples:s
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

hax
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes',[hax1 hax2]);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV','elim',[-10 10],'axes',[hax1 hax2]);
\end_layout

\begin_layout Section
Class 
\family typewriter
EMProc
\end_layout

\begin_layout Standard
An 
\family typewriter
EMProc
\family default
 object is used to ....
 The class provides the following functionality:
\end_layout

\begin_layout Itemize
Plot 
\end_layout

\begin_layout Itemize
Batch mode for 
\end_layout

\begin_layout Itemize
Batch mode for transfer function estimation 
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Standard

\family typewriter
obj = EMProc(<propath>); 
\family default
% set global reference time and project path
\end_layout

\begin_layout Standard

\family typewriter
obj = EMTimeSeries(obj,{'<site1>' '<site2>' ...}); 
\family default
% read data from site
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.propath {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.fcpath {'./fc'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tfpath {'./tf'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.datapath {'./EDE/run*','./ADU/meas*'} 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsname {}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrate []; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsname {}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrate []; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.refname {}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.input {'Bx' 'By'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.input {'Ex' 'Ey'};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.refch {'Bx' 'By'}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usedec {1}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usetime []; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.fcrange []; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.procdef []; % settings for EMRobustProcessing object.
 If empty, default settings are used; otherwise you may pass a struct to
 procdef with fields whose names correspond to valid public properties of
 an EMRobustProcessing object;
\begin_inset Newline newline
\end_inset

Example;
\begin_inset Newline newline
\end_inset

>> procdef.reg = 'Mestimate';
\begin_inset Newline newline
\end_inset

>> procdef.cohthres = {[0.9 1]};
\begin_inset Newline newline
\end_inset

>> obj.procdef = procdef;
\begin_inset Newline newline
\end_inset

Then, these settings will be used for transfer function estimation instead
 of the deault ones.
 See public properties of EMRobustProcessing for a list of valid properties.
 Note that at the moment, the values in procdef are not tests for their
 validity ...
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel = 0 | 1 | 2; 
\end_layout

\begin_layout Subsection
Private properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sites
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
cell array with all station names
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.site
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
cell array collecting all 
\family typewriter
EMSpectra
\family default
 objects
\family typewriter
.

\family default
 
\end_layout

\begin_layout Subsection
Dependent properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsind
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
index into local site.
 Local 
\family typewriter
EMSpectra
\family default
 objects are available from
\family typewriter
 obj.site{obj.lsind}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lNruns 
\family default
Number of runs (
\family typewriter
EMSpectra
\family default
 objects available) for local site 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrates 
\family default
sampling rates for each of the runs at the local site
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsrateind 
\family default
index vector into runs of local site which match the requested sampling
 rate 
\family typewriter
obj.lsrate
\family default
.
 
\family typewriter
EMSpectra
\family default
 objects of the local site at this sampling rate are accessed with 
\family typewriter
obj.site{obj.lsind}(obj.lsrateind)
\family default
 and returns a cell array with 
\family typewriter
EMSpectra
\family default
 objects.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.locasite 
\family default
cell array with time series objects matching the current local site (
\family typewriter
obj.lsname
\family default
) at the current sampling rate (
\family typewriter
obj.lsrate
\family default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsind
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
index vector into base sites.
 Base site 
\family typewriter
EMSpectra
\family default
 objects for the 
\family typewriter
ibs
\family default
-st base site are available from
\family typewriter
 obj.site{obj.bsind{ibs}}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bNruns 
\family default
vector with number of runs (
\family typewriter
EMSpectra
\family default
 objects available) for base sites 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsrates 
\family default
cell array of sampling rates at each base site and each run .
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsrateind 
\family default
cell array of index vectors into runs of base site which match one the requested
 sampling rates in 
\family typewriter
obj.bsrate
\family default
.
 
\family typewriter
EMSpectra
\family default
 objects of base site at this particular sampling rate are accessed with
 
\family typewriter
obj.site{obj.bsind{ibs}}(obj.lsrateind{ibs})
\family default
 and returns a cell array 
\family typewriter
EMSpectra
\family default
 objects.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.basesite 
\family default
cell array with time series objects matching one of the base sites (
\family typewriter
obj.bsname
\family default
) at the current sampling rates (
\family typewriter
obj.bsrate
\family default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tf 
\family default
triggers estimation of transfer functions for the curent settings.
 
\family typewriter
tf 
\family default
is a struct with the following fields:
\begin_inset Newline newline
\end_inset

...
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.coh 
\family default
univariate or bivariate coherency, depending on the number of the input
 channels
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tfs 
\family default
Transfer functions estimated for each pixel of the smoothed spectral matrics.

\family typewriter
 
\family default
The Dimension is 
\family typewriter
Nfc x Nsets x (Ninput*Noutput)
\family default
 for the current decimation level 
\family typewriter
usedec
\family default
, 
\family typewriter
fcrange
\family default
 and 
\family typewriter
setrange, obj.input, obj.output.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.pol 
\family default
Polarization characetristics of the 2 input channels 
\family typewriter
obj.input
\family default
, formed from the eigenvalue decomposition of the
\family typewriter
 2x2 
\family default
smoothed spectral matrix of the input channels.

\family typewriter
 pol.deg
\family default
 is the degree of polarization and 
\family typewriter
pol.or
\family default
 is the polarization direction (should be positive clockwise from north).
 The dimension of these fields is 
\family typewriter
Nfc x Nsets
\family default
 for the current decimation level 
\family typewriter
usedec
\family default
, 
\family typewriter
fcrange
\family default
 and 
\family typewriter
setrange
\end_layout

\begin_layout Subsection
Methods
\end_layout

\begin_layout Standard

\series bold
(these methods are not yet implemented with full options!)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

obj 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

display(obj); 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

str
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj);
\family default
 text output returned in a cell aray of strings 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plottfs(obj,varargin) 
\family default
Plot individual transfer functions
\family typewriter
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments
\begin_inset space ~
\end_inset

:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plottfs(obj,varargin);
\family default
 returns the handles to the axes.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plotpol(obj,varargin) 
\family default
Plot degree of polarization and polarization angle
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments
\begin_inset space ~
\end_inset

:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plottfs(obj,varargin);
\family default
 returns the handles to the axes.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plotcoh(obj,varargin) 
\family default
Plot coherencies between each input and output channels.
 
\family typewriter
if numel(input)==1
\family default
, univariate coherencies are computed; else 
\family typewriter
if numel(input)==
\family default
2, bivariate coherencies are computed.
 Only data within the time window given by 
\family typewriter
obj.usetime
\family default
 are used; if 
\family typewriter
obj.usetime
\family default
 is empty, all sets are used.
 
\family typewriter
varargin 
\family default
is a variable sequence of keywords followed by a valid value, 
\family typewriter
varargout
\family default
 returns an array of axes handles.
 
\end_layout

\begin_layout Section
Class 
\family typewriter
EDEs
\end_layout

\begin_layout Standard
An 
\family typewriter
EDEs
\family default
 object is used to access EDE data 
\family typewriter
*.mtd/*.txt
\family default
-format.
 The data reside in one directory corresponding to one run.
\end_layout

\begin_layout Paragraph
2do: 
\end_layout

\begin_layout Itemize
lsb field must be a vector with one lsb value for each channel, to be consistent
 with the adu.
\end_layout

\begin_layout Itemize
include decimation
\end_layout

\begin_layout Itemize
include interrupted recordings as multiple runs
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Subsubsection
Reading 
\family typewriter
*.mtd/*.txt
\family default
 data
\end_layout

\begin_layout Standard
The object can be initialized with the commands
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EDEs; % returns an EDEs object with default properties
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EDEs('obj','pathname'); % populates an existing EDEs object
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EDEs('pathname'); % creates a new EDEs object and populates it
\end_layout

\begin_layout Standard
Here, 
\family typewriter
pathname 
\family default
is the name of a valid path which contains a continous recording (run) stored
 in multiple pairs of
\family typewriter
 *.mtd/*.txt
\family default
 files.
 
\end_layout

\begin_layout Standard
During the construction of the object, only the header information is read
 from the files and stored in the objects' properties.
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.source
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
path to the data directory of the run
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.name
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
station name
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.system
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
type of recording system
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.systemSN 
\family default
serial number of recording system
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.run
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
run number 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lat
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Latitude (deg)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lon
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Longitude (deg)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.alt
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Altitude (m), usually set to zero
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsb
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
conversion factor of 
\family typewriter
int32
\family default
 to mV.
 
\family typewriter
lsb = (5/2^32)*1000;
\family default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nch
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
number of channels.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.chnames
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
channels names.

\family typewriter
 chnames = {'Ex' 'Ey'};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dipole
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
length of electric dipoles.
 For two channels, 
\family typewriter
dipole=[l1 l2];
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.orient
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
orientation of dipole/sensor
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tilt
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
tilt of sensor; ususally zero for electric fields
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sens_sn
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
serial number of sensors.

\family typewriter
 sens_sn = {[N S] [E W]
\begin_inset space ~
\end_inset

...}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sens_name
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
name of sensor, e.g.
 .

\family typewriter
 sens_name = {'AgAgCl' 'AgAgCl' ...}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.srate
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
sampling rate
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmp
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
total number of samples, taken over all data files
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.starttime 
\family default
starttime of the recording (1st sample) 
\family typewriter
[yyyy mm dd hh mm ss]
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.starttimems 
\family default
milli-seconds of the 1st sample
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.ppsdelay 
\family default
Delay of pps signal; i.e.
 all samples are actually later by 
\family typewriter
ppsdelay.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.reftime 
\family default
reference time being used for plotting etc.
 It is intende to use this as the time to which all time windows for spectral
 estimation will refer
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nfiles
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Number of data files
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.mtdfiles *.mtd
\family default
 datafiles
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.hdfiles *.txt
\family default
 headerfiles
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.startstopfile Nfiles x 14 
\family default
array containing the times of the first and last sample in each file.
 The first 7 columns correspond to the date vector of the first sample (includin
g milliseconds in the 7th column), and the last 7 columns contain the date
 vector of the last sample in the file (again including the milliseconds
 in the 14th column)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmpfile Nfiles x 2 
\family default
array containing the indices of the first and last sample contained in each
 file relative to the overall first sample
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usech
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
channels to be used for whatever (e.g.
 for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesmp
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
sample range (relative to first sample of the current run) to be used for
 whatever (e.g.
 for plotting).
 To calculate the sample range for a given time range, use the method 
\family typewriter
usesmp = get_usesmp(obj,usetime); 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dec
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
decimate data by this factor.
 Must be an integer.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.resmpfreq
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
resample data to this frequency; must be larger than 1 Hz
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsoutdir
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Output directory for converted 
\family typewriter
*.ats
\family default
 files.
 Default is 
\family typewriter
atsoutdir = {''} 
\family default
and means that the 
\family typewriter
*.ats
\family default
 files will be written to the 
\family typewriter
ede
\family default
 data directory given by 
\family typewriter
obj.source
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.afcoutdir
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Output directory for fourie coefficient files 
\family typewriter
*.afc
\family default
 files.
 Default is 
\family typewriter
afcoutdir = {''} 
\family default
and means that the 
\family typewriter
*.afc
\family default
 files will be written to the 
\family typewriter
ede
\family default
 data directory given by 
\family typewriter
obj.source
\family default
.
 (not implemented)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel
\begin_inset space ~
\end_inset

 
\family default
Degree of information returned on the command line.
 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 0;
\family default
 only error messages; 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 1;
\family default
 
\family typewriter
(default)
\family default
 some information; 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 2;
\family default
 information and not so important warnings
\end_layout

\begin_layout Subsection
\noindent
Dependent properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.starttimestr
\family default
 Starttime as a string
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.stoptimestr
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usetime
\family default
 time range being to be used; derived from usesmp (
\series bold
not implemented
\series default
)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usefiles *.mtd
\family default
 files which contain the data defined by 
\family typewriter
usesmp
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataint 
\family default
integer data as stored in the file; these data are not being resampled,
 because this would result in floating point numbers.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataproc 
\family default
resampled data, if obj.resmpfreq is set; otherwise the same as dataint.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
obj.data dataproc
\family default
 multiplied by the 
\family typewriter
obj.lsb 
\family default
value
\family typewriter
 
\family default
to obtain
\family typewriter
 mV.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataphys data 
\family default
divided by the 
\family typewriter
obj.dipole 
\family default
length
\family sans
, or multiplied by the coil sensitivity to obtain
\family typewriter
 mV/m 
\family default
or
\family typewriter
 mV/nT
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.smp 
\family default
sample vector for each sample (e.g sample axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to startt of recording
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.rsmp 
\family default
sample vector for each sample (e.g sample axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trs 
\family default
seconds vector for each sample (e.g time axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trh 
\family default
hours vector for each sample (e.g time axis for plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trd 
\family default
days vector for each sample (e.g time axis for plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.utc 
\family default
utc time vector (matlab datenum format) for each sample (e.g time axis for
 plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesmpr 
\family default
used samples for resampled data, derived from
\family typewriter
 usesmp 
\family default
and
\family typewriter
 resmpfreq
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmpr 
\family default
Number of samples of the resampled data, derived from
\family typewriter
 usesmpr
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.smpr 
\family default
sample vector for each sample of the resampled data
\family typewriter
 
\family default
(e.g sample axis for plotting) as defined by 
\family typewriter
usesmpr
\family default
, relative to start of recording
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.rsmpr 
\family default
sample vector for each sample of the resampled data (e.g sample axis for
 plotting) as defined by 
\family typewriter
usesmpr
\family default
 relative to to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trsr 
\family default
seconds vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trhr 
\family default
hours vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trdr 
\family default
days vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.utcr 
\family default
utc time vector for each sample of the resampled data (e.g time axis for
 plotting) as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsheader 
\family default
returns a struct with all the information contained in the header of an
 
\family typewriter
*.ats
\family default
 file
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsfile
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
invoking the 
\family typewriter
atsfile
\family default
 property ats triggers an export of the data into 
\family typewriter
*.ats
\family default
 format.
 
\family typewriter
atsfile
\family default
 is a cell array fith the filenames of the written 
\family typewriter
*.ats
\family default
 files.
 Note that the data are written for the channels contained in 
\family typewriter
obj.usech
\family default
, for the sample range given by 
\family typewriter
obj.usesmp
\family default
, and resampled to 
\family typewriter
obj.resmplfreq
\family default
.
 The default output directory is the directory of the 
\family typewriter
*.mtd/*.txt 
\family default
ede data files, but the output path can be changed by changing the value
 of 
\family typewriter
obj.atsoutdir.
\end_layout

\begin_layout Subsection
\noindent
Methods
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj); 
\family default
Output some station details for the object-
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

obj 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

display(obj); 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

str
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj);
\family default
 text output returned in a cell aray of strings
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
usesmp
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

get_usesmp(obj,usetime); 
\family default
Calculate sample indices corresponding to a given time interval.
 Provide a datevector of type 
\family typewriter
usetime = [<from> <to>]
\family default
; where 
\family typewriter
<from> 
\family default
and
\family typewriter
 <to> 
\family default
are variables in format 
\family typewriter
[yyyy mm dd hh mm ss]
\family default
.
 The first extracted sample from the file is exactly recorded at the time
 
\family typewriter
<from>
\family default
, whereas the last sample is exactly recorded at the time
\family typewriter
 <to> - 1/obj.srate
\family default
 (i.e.
 one sample less before the 
\family typewriter
<to>
\family default
 time!).
 If the 
\family typewriter
<from>
\family default
 is earlier in time than the actual start of the recording (i.e.
 
\family typewriter
obj.starttime+obj.starttimems/1000
\family default
), then the start of the recording will be used instead.
 If 
\family typewriter
<to> 
\family default
is later than the end of the recording (
\family typewriter
obj.stoptime+obj.stoptimems/1000
\family default
), then the end of recording will be used instead.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

usesmp
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

get_usesmp(obj,[2014 3 17 10 00 00 2014 3 17 20 00 00]);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varagout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,varargin} 
\family default
Plot time series for the time segment given by 
\family typewriter
obj.usesmp
\family default
.
 
\family typewriter
varargin 
\family default
is a variable sequence of keywords followed by a valid value, 
\family typewriter
varargout
\family default
 returns an array of axes handles.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Input
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'time',
\begin_inset space ~
\end_inset

value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of 
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'smp';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
samples relative to the beginning of the recording
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'relative smp';
\family default
samples relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative s';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
seconds relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative h';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
hours relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative d';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
days relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'utc';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
UTC time
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'units',value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of
\begin_inset Newline newline
\end_inset


\family typewriter
value = 'int';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plots 
\family typewriter
obj.dataint
\family default
 as integer numbers without any conversion to physical units
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'mV';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data=obj.dataint*obj.lsb
\family default
 in 
\family typewriter
mV
\begin_inset Newline newline
\end_inset

value = 'physical';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data/obj.dipole 
\family default
in 
\family typewriter
mV/m
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

'elim',value,
\family default
 axis scaling for electric field plots, in the scale of 
\family typewriter
'units';
\family default
 Default is auto scaling
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'color',
\begin_inset space ~
\end_inset

value 
\family default
color code for plotting, can be one of the valid matlab colors (e.g.
 'r', 'k', 'b' ,...) or a [r g b] vector.

\family typewriter
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'elim',
\begin_inset space ~
\end_inset

value
\begin_inset Newline newline
\end_inset

value = [min max]; 
\family default
scales the electric field axes
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'factor',
\begin_inset space ~
\end_inset

value
\begin_inset Newline newline
\end_inset

value = [fac1 fac2 ...]; 
\family default
multiplies each channel by a factor
\family typewriter
.
 
\family default
Dimension of 
\family typewriter
value
\family default
 must match the dimension of 
\family typewriter
obj.usech
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'axes',
\begin_inset space ~
\end_inset

value
\begin_inset Newline newline
\end_inset

value = [hax1 hax2 ...]; 
\family default
plot the data into the existing axes
\family typewriter
 [hax1 hax2 ...]
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax = plot(obj,varargin);
\family default
 returns the handles to each axes.

\family typewriter
 
\family default
Dimension of 
\family typewriter
hax 
\family default
corresponds to dimension of 
\family typewriter
obj.usech
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Examples:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

hax
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes',[hax1 hax2]);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV','elim',[-10 10],'factor',[1 -1],'axes',[hax1
 hax2]);
\end_layout

\begin_layout Section
Class 
\family typewriter
ADU
\end_layout

\begin_layout Standard
An 
\family typewriter
ADU
\family default
 object is used to access ADU data in 
\family typewriter
*.ats
\family default
-format.
 The data reside in one directory corresponding to one run, typically of
 name 
\family typewriter
meas*
\family default
.
\end_layout

\begin_layout Paragraph
2do: 
\end_layout

\begin_layout Itemize
include output of resampled data 
\end_layout

\begin_layout Itemize
include decimation
\end_layout

\begin_layout Itemize
include interrupted recordings as multiple runs, or recrodings at different
 sampling rates
\end_layout

\begin_layout Itemize
xml files are not read
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Subsubsection
Reading 
\family typewriter
*.ats
\family default
 data
\end_layout

\begin_layout Standard
The object can be initialized with the commands
\end_layout

\begin_layout Standard

\family typewriter
>> obj = ADUs; % returns an ADUs object with default properties
\end_layout

\begin_layout Standard

\family typewriter
>> obj = ADUs('obj','pathname'); % populates an existing ADUs object
\end_layout

\begin_layout Standard

\family typewriter
>> obj = ADUs('pathname'); % creates a new ADUs object and populates it
\end_layout

\begin_layout Standard
Here, 
\family typewriter
pathname 
\family default
is the name of a valid path which contains a continous recording (run) stored
 in multiple
\family typewriter
 *.ats
\family default
 files.
 
\end_layout

\begin_layout Standard
During the construction of the object, only the header information is read
 from the files and stored in the objects' properties.
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.source
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
path to the data directory of the run
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.name
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
station name
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.system
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
type of recording system
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.systemSN 
\family default
serial number of recording system
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.run
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
run number 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lat
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Latitude (deg)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lon
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Longitude (deg)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.alt
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Altitude (m), usually set to zero
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lsb
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
conversion factor of 
\family typewriter
int32
\family default
 to mV.
 
\family typewriter
lsb = (5/2^32)*1000;
\family default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nch
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
number of channels.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.chnames
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
channels names.

\family typewriter
 chnames = {'Ex' 'Ey'};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dipole
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
length of electric dipoles.
 For two channels, 
\family typewriter
dipole=[l1 l2];
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.orient
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
orientation of dipole/sensor
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tilt
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
tilt of sensor; ususally zero for electric fields
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sens_sn
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
serial number of sensors.

\family typewriter
 sens_sn = {[N S] [E W]
\begin_inset space ~
\end_inset

...}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.sens_name
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
name of sensor, e.g.
 .

\family typewriter
 sens_name = {'AgAgCl' 'AgAgCl' ...}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.srate
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
sampling rate
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmp
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
total number of samples, taken over all data files
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.starttime 
\family default
starttime of the recording (1st sample) 
\family typewriter
[yyyy mm dd hh mm ss]
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.starttimems 
\family default
milli-seconds of the 1st sample
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.ppsdelay 
\family default
Delay of pps signal; i.e.
 all samples are actually later by 
\family typewriter
ppsdelay.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.reftime 
\family default
reference time being used for plotting etc.
 It is intende to use this as the time to which all time windows for spectral
 estimation will refer
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nfiles
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Number of data files
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.mtdfiles *.mtd
\family default
 datafiles
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.hdfiles *.txt
\family default
 headerfiles
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.startstopfile Nfiles x 14 
\family default
array containing the times of the first and last sample in each file.
 The first 7 columns correspond to the date vector of the first sample (includin
g milliseconds in the 7th column), and the last 7 columns contain the date
 vector of the last sample in the file (again including the milliseconds
 in the 14th column)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmpfile Nfiles x 2 
\family default
array containing the indices of the first and last sample contained in each
 file relative to the overall first sample
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usech
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
channels to be used for whatever (e.g.
 for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesmp
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
sample range (relative to first sample of the current run) to be used for
 whatever (e.g.
 for plotting).
 To calculate the sample range for a given time range, use the method 
\family typewriter
usesmp = get_usesmp(obj,usetime); 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dec
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
decimate data by this factor.
 Must be an integer.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.resmpfreq
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
resample data to this frequency; must be larger than 1 Hz
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsoutdir
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Output directory for converted 
\family typewriter
*.ats
\family default
 files.
 Default is 
\family typewriter
atsoutdir = {''} 
\family default
and means that the 
\family typewriter
*.ats
\family default
 files will be written to the 
\family typewriter
ede
\family default
 data directory given by 
\family typewriter
obj.source
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.afcoutdir
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Output directory for fourie coefficient files 
\family typewriter
*.afc
\family default
 files.
 Default is 
\family typewriter
afcoutdir = {''} 
\family default
and means that the 
\family typewriter
*.afc
\family default
 files will be written to the 
\family typewriter
ede
\family default
 data directory given by 
\family typewriter
obj.source
\family default
.
 (not implemented)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel
\begin_inset space ~
\end_inset

 
\family default
Degree of information returned on the command line.
 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 0;
\family default
 only error messages; 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 1;
\family default
 
\family typewriter
(default)
\family default
 some information; 
\family typewriter

\begin_inset Newline newline
\end_inset

debuglevel = 2;
\family default
 information and not so important warnings
\end_layout

\begin_layout Subsection
\noindent
Dependent properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.starttimestr
\family default
 Starttime as a string
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.stoptimestr
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usetime
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
time range being to be used; derived from usesmp
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usefiles *.mtd
\family default
 files which contain the data defined by 
\family typewriter
usesmp
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataint 
\family default
integer data as stored in the file; these data are not being resampled,
 because this would result in floating point numbers.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataproc 
\family default
resampled data, if obj.resmpfreq is set; otherwise the same as dataint.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
obj.data dataproc
\family default
 multiplied by the 
\family typewriter
obj.lsb 
\family default
value
\family typewriter
 
\family default
to obtain
\family typewriter
 mV.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.dataphys data 
\family default
divided by the 
\family typewriter
obj.dipole 
\family default
length
\family sans
, or multiplied by the coil sensitivity to obtain
\family typewriter
 mV/m 
\family default
or
\family typewriter
 mV/nT
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.smp 
\family default
sample vector for each sample (e.g sample axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to start of recording
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.rsmp 
\family default
sample vector for each sample (e.g sample axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trs 
\family default
seconds vector for each sample (e.g time axis for plotting) as defined by
 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trh 
\family default
hours vector for each sample (e.g time axis for plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trd 
\family default
days vector for each sample (e.g time axis for plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.utc 
\family default
utc time vector (matlab datenum format) for each sample (e.g time axis for
 plotting) as defined by 
\family typewriter
usesmp
\family default
, but relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usesmpr 
\family default
used samples for resampled data, derived from
\family typewriter
 usesmp 
\family default
and
\family typewriter
 resmpfreq
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nsmpr 
\family default
Number of samples of the resampled data, derived from
\family typewriter
 usesmpr
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.smpr 
\family default
sample vector for each sample of the resampled data
\family typewriter
 
\family default
(e.g sample axis for plotting) as defined by 
\family typewriter
usesmpr
\family default
, relative to start of recording
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.rsmpr 
\family default
sample vector for each sample of the resampled data (e.g sample axis for
 plotting) as defined by 
\family typewriter
usesmpr
\family default
 relative to to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trsr 
\family default
seconds vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trhr 
\family default
hours vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.trdr 
\family default
days vector for each sample of the resampled data (e.g time axis for plotting)
 as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.utcr 
\family default
utc time vector for each sample of the resampled data (e.g time axis for
 plotting) as defined by 
\family typewriter
usesmpr
\family default
 relative to 
\family typewriter
reftime
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsheader 
\family default
returns a struct with all the information contained in the header of an
 
\family typewriter
*.ats
\family default
 file
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.atsfile
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
invoking the 
\family typewriter
atsfile
\family default
 property ats triggers an export of the data into 
\family typewriter
*.ats
\family default
 format.
 
\family typewriter
atsfile
\family default
 is a cell array fith the filenames of the written 
\family typewriter
*.ats
\family default
 files.
 Note that the data are written for the channels contained in 
\family typewriter
obj.usech
\family default
, for the sample range given by 
\family typewriter
obj.usesmp
\family default
, and resampled to 
\family typewriter
obj.resmplfreq
\family default
.
 The default output directory is the directory of the 
\family typewriter
*.mtd/*.txt 
\family default
ede data files, but the output path can be changed by changing the value
 of 
\family typewriter
obj.atsoutdir.
\end_layout

\begin_layout Subsection
\noindent
Methods
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
varargout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj); 
\family default
Output some station details for the object-
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

obj 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

display(obj); 
\family default
text output into the command window
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

str
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

display(obj);
\family default
 text output returned in a cell aray of strings
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
usesmp
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

get_usesmp(obj,usetime); 
\family default
Calculate sample indices corresponding to a given time interval.
 Provide a datevector of type 
\family typewriter
usetime = [<from> <to>]
\family default
; where 
\family typewriter
<from> 
\family default
and
\family typewriter
 <to> 
\family default
are variables in format 
\family typewriter
[yyyy mm dd hh mm ss]
\family default
.
 The first extracted sample from the file is exactly recorded at the time
 
\family typewriter
<from>
\family default
, whereas the last sample is exactly recorded at the time
\family typewriter
 <to> - 1/obj.srate
\family default
 (i.e.
 one sample less before the 
\family typewriter
<to>
\family default
 time!).
 If the 
\family typewriter
<from>
\family default
 is earlier in time than the actual start of the recording (i.e.
 
\family typewriter
obj.starttime+obj.starttimems/1000
\family default
), then the start of the recording will be used instead.
 If 
\family typewriter
<to> 
\family default
is later than the end of the recording (
\family typewriter
obj.stoptime+obj.stoptimems/1000
\family default
), then the end of recording will be used instead.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Example:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

usesmp
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

get_usesmp(obj,[2014 3 17 10 00 00 2014 3 17 20 00 00]);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
varagout
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,varargin} 
\family default
Plot time series for the time segment given by 
\family typewriter
obj.usesmp
\family default
.
 
\family typewriter
varargin 
\family default
is a variable sequence of keywords followed by a valid value, 
\family typewriter
varargout
\family default
 returns an array of axes handles.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Input
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'time',
\begin_inset space ~
\end_inset

value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of 
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'smp';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
samples relative to the beginning of the recording
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'relative smp';
\family default
samples relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative s';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
seconds relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative h';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
hours relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'relative d';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
days relative to 
\family typewriter
obj.reftime
\begin_inset Newline newline
\end_inset

value = 'utc';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
UTC time
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'units',value,
\family default
 appearance of time axis where 
\family typewriter
value
\family default
 can be one out of
\begin_inset Newline newline
\end_inset


\family typewriter
value = 'int';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plots 
\family typewriter
obj.dataint
\family default
 as integer numbers without any conversion to physical units
\family typewriter

\begin_inset Newline newline
\end_inset

value = 'mV';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data=obj.dataint*obj.lsb
\family default
 in 
\family typewriter
mV
\begin_inset Newline newline
\end_inset

value = 'physical';
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
plot 
\family typewriter
obj.data/obj.dipole 
\family default
in 
\family typewriter
mV/m
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

'elim',value,
\family default
 axis scaling for electric field plots, in the scale of 
\family typewriter
'units';
\family default
 Default is auto scaling
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'color',
\begin_inset space ~
\end_inset

value 
\family default
color code for plotting, can be one of the valid matlab colors (e.g.
 'r', 'k', 'b' ,...) or a [r g b] vector.

\family typewriter
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'elim', value
\begin_inset Newline newline
\end_inset

value = [min max]; 
\family default
scales the electric field axes
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'factor', value
\begin_inset Newline newline
\end_inset

value = [fac1 fac2 ...]; 
\family default
multiplies each channel by a factor
\family typewriter
.
 
\family default
Dimension of 
\family typewriter
value
\family default
 must match the dimension of 
\family typewriter
obj.usech
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
'axes', value
\begin_inset Newline newline
\end_inset

value = [hax1 hax2 ...]; 
\family default
plot the data into the existing axes
\family typewriter
 [hax1 hax2 ...]
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Output
\begin_inset space ~
\end_inset

arguments:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
hax = plot(obj,varargin);
\family default
 returns the handles to each axes.

\family typewriter
 
\family default
Dimension of 
\family typewriter
hax 
\family default
corresponds to dimension of 
\family typewriter
obj.usech
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
Examples:s
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

hax
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes');
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','axes',[hax1 hax2]);
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
>>
\begin_inset space ~
\end_inset

plot(obj,'time','UTC','units','mV','elim',[-10 10],'factor',[1 -1],'axes',[hax1
 hax2]);
\end_layout

\begin_layout Section
Class 
\family typewriter
EMSpectra
\end_layout

\begin_layout Standard
An 
\family typewriter
EMSpectra
\family default
 object is used to compute spectrograms or access the data stored in one
 fourier coefficient file 
\family typewriter
*.afc
\family default
.
 
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Standard
The object can be initialized with the following commands:
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMSpectra; 
\family default
% returns a default 
\family typewriter
EMSpectra
\family default
 object.
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMSpectra('filename.afc'); 
\family default
% reads a 
\family typewriter
*.afc
\family default
 file named 
\family typewriter
'filename.afc'
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMSpectra(obj,ede); 
\family default
% computes a spectrogram from an ede object and stores the output to an
 
\family typewriter
*.afc
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMSpectra(obj,adu); 
\family default
% computes a spectrogram from an adu object and stores the output to an
 
\family typewriter
*.afc
\end_layout

\begin_layout Standard

\family typewriter
obj
\family default
 contains the header information of the 
\family typewriter
*.afc
\family default
 file and allows acces to its contents.
 
\end_layout

\begin_layout Subsubsection
Computation and storage of spectrograms
\end_layout

\begin_layout Standard
Spectrograms are computed in a cascade fashion with a windowed fourier transform
ation: The scheme involves the steps a) decimation, b) segmenting into overlappi
ng windows c) multiplication with a taper d) fourier transformation e) multiplic
ation with calibration functions.
 These steps are usually applied to short windows - yielding a narrow frequency
 band - and repeated for various decimation levels.
 The decimation scheme is defined by the properties 
\family typewriter
Ndec
\family default
 and 
\family typewriter
decimate
\family default
, where 
\family typewriter
decimate
\family default
 is a vector of dimension 
\family typewriter
Ndec
\family default
 and defines the factors by which the time series are decimated from one
 level to the next.
 A typical choice for MT processing is for instance to use windows of 128
 samples length, which overlap by 32 samples, and which will be decimated
 at consecutive factors of 4 at, say, seven levels, including the original
 sampling rate (=decimation level 1).
 In this case, we define
\end_layout

\begin_layout Standard

\family typewriter
>> obj.Ndec 
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

= 7;
\end_layout

\begin_layout Standard

\family typewriter
>> obj.decimate = [1 4 4 4 4 4 4];
\end_layout

\begin_layout Standard

\family typewriter
>> obj.wlength
\begin_inset space ~
\end_inset

 = [128 128 128 128 128 128 128];
\end_layout

\begin_layout Standard

\family typewriter
>> obj.noverlap = [32 32 32 32 32 32 32];
\end_layout

\begin_layout Standard
Let the original sampling rate be 
\family typewriter
512 Hz
\family default
.
 Then, the sampling rates of the decimated time series will then be
\family typewriter
 [512 128 32 8 2 1/2 1/8 1/32]
\family default
.
 Because the time series is real, we store only half of the fourier coefficients
 for each window, plus the DC component for completeness.
 In the above example, this would correspond to 65 coefficients for each
 time window at each decimation level, where the first entry is the DC component
, and the remaing 64 coefficients span the frequency domain covered by the
 window.
 
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
For later processing purposes (e.g.
 remote reference, inter-station transfer functions, etc) it is very important
 to perform the windowing of the time series for an entire survey on a common
 time axis to ensure that windows overlap exactly.
 This time axis is defined relative to a global survey time, the 
\family typewriter
reftime
\family default
.
 It is thus 
\series bold
very important to use the same 
\family typewriter
reftime
\family default
 and the same decimation scheme 
\series default
 for data that shall be combined in fourier domain.
 Note that the EMspectra property 
\family typewriter
obj.reftime
\family default
 will overwrite the 
\family typewriter
reftime
\family default
 property in the respective time series object; it is therefore not required
 to set this property explicitly in the 
\family typewriter
EDEs
\family default
 and 
\family typewriter
ADUs
\family default
 (and any other) objects being transformed.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
Note: The data to transform are the resampled data, if the resampling option
 is activated in the 
\family typewriter
EDEs
\family default
 and 
\family typewriter
ADUs
\family default
 (and any other) objects, i.e.
 if in the 
\family typewriter
ede.resmpfreq>0
\family default
 or 
\family typewriter
adu.resmpfreq > 0
\family default
; otherwise, the original data are used.
 Only the time segment corresponding to the 
\family typewriter
usesmp
\family default
 property and the channels defined by 
\family typewriter
usech
\family default
 are extracted.
 Example:
\end_layout

\begin_layout Plain Layout

\family typewriter
>> usetime = [2014 03 21 18 00 00 2014 03 22 00 00 00]; % we look at 6 hours,
 from midnight to noon 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> reftime = [2014 03 21 00 00 00]; % survey reference time
\end_layout

\begin_layout Plain Layout

\family typewriter
>> adu = ADUs(<pathname>); 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> adu.usesmp = get_usesmp(adu,usetime); % this returns the samples corresponding
 to usetime 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> adu.resmpfreq = 128; % resampling of the data to 128 Hz
\end_layout

\begin_layout Plain Layout

\family typewriter
>> sp = EMSpectra; 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> sp.source = {'D:
\backslash
DCtrain
\backslash
A02
\backslash
fd'}; % output directory, where the *.afc 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> sp.reftime = reftime; 
\end_layout

\begin_layout Plain Layout

\family typewriter
>> sp = EMSpectra(sp,adu);
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Reading spectrograms
\end_layout

\begin_layout Standard
Existing spectra are accessed by the command
\end_layout

\begin_layout Standard

\family typewriter
>> sp = EMSpectra('filename.afc'); 
\family default
% reads a 
\family typewriter
*.afc
\family default
 file named 
\family typewriter
'filename.afc'
\end_layout

\begin_layout Standard
Band set up definitons (which fourier coefficients are to be averaged for
 a single target frequency) are defined in 
\family typewriter
@EMSpectra
\backslash
private
\backslash
sp_defaultbs.m
\family default
.
 Modify this function to your needs.
 The default produces averaging rules for logarithimcally equidistant target
 frequencies with two target frequencies per octave.
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Standard
Additional properties must be defined to extract the data subsets of interest.
 These include the range of frequencies, the range of sets (time windows),
 the decimation level and the channels.
 These properties are listed below; default values are given.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.source {'filename.afc'}
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.name '000'
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.run '001'
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lat 0
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.lon 0
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.alt 0
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.reftime [1970 1 1 0 0 0]; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.caldir {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Ndec 7; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.decimate [1 4 4 4 4 4 4];
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.wlength [128 128 128 128 128 128 128]; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.noverlap [32 32 32 32 32 32 32]; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.prew [0 0 0 0 0 0 0];
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.window 'dpss'; 
\family default
% window type 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.timebandwidth 5/2; % 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Nk 1; 
\family default
% number of tapers for each decimation level 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.delayfilt 0; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bandsetup 'MT' 
\family default
% default band setup.
 Band set up definitons (which fourier coefficients are to be averaged for
 a single target frequency) are defined in 
\family typewriter
@EMSpectra
\backslash
private
\backslash
sp_defaultbs.m
\family default
.
 Modify this function to your needs.
 The default produces averaging rules for logarithimcally equidistant target
 frequencies with two target frequencies per octave.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsfc {};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bsfcenter {};
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.usedec
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\family default
Intdex to define the current decimation level to be used.
 Default value is 
\family typewriter
1.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.fcrange
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Two-component index vector to define First and last index of the range
 of fourier coefficients.
 Default is 
\family typewriter
[]
\family default
 and returns all frequencies.
 To return a subset only, set 
\family typewriter

\begin_inset Newline newline
\end_inset

>> obj.fcrange = [<frst> <last>];
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.setrange
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 N-component index vector to define the range of sets (time windows).
 Default is 
\family typewriter
[]
\family default
 and returns all sets.
 To return a subset only, set 
\family typewriter

\begin_inset Newline newline
\end_inset

>> obj.setrange = [<indexvector>]; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.input
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Cell array to define the input channels.
 Default is 
\family typewriter
{'Bx' 'By'}
\family default
.
 Note that channels are identified by their given name.
 Multiple channels as well as a single channels is allowed
\family typewriter
.

\family default
 One possible example is
\family typewriter

\begin_inset Newline newline
\end_inset

>> obj.input = {'Ex'};
\begin_inset Newline newline
\end_inset


\family default
when the input channel is stored under the name 
\family typewriter
'Ex'.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.output
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Cell array to define the input channels.
 Default is 
\family typewriter
{'Bz'}
\family default
.
 Multiple output channels are allowed.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel
\begin_inset space ~
\end_inset


\family default
 Output some debugging information.
 Default value is 
\family typewriter
1.
\end_layout

\begin_layout Standard
The particular way of channel grouping into input and output channels is
 motivated by the later processing objectiv, where we will be interested
 to estimate (multi-)linear transfer functions 
\series bold

\begin_inset Formula $\mathbf{T}$
\end_inset


\series default
 between some input channels 
\begin_inset Formula $\mathbf{X}$
\end_inset

 and output channels 
\begin_inset Formula $\mathbf{Y}$
\end_inset

.
\end_layout

\begin_layout Subsection
\noindent
Private properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.global_headerlength 1024; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.channel_headerlength 1024; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.srate 
\family default
sampling rate of the undecimated data
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.smprange 
\family default
range of samples of the undecimated data relative to 
\family typewriter
reftime
\family default
 corresponding to the time window given by 
\family typewriter
usetime
\family default
 resp.
 
\family typewriter
usesmp
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nch 0; 
\family default
number of channels 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.tssource {''}; 
\family default
source directory for time series 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.chnames {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.chtypes {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.sens_name {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.sens_sn {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.calfile {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.caldata {''}; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.srate 0; 
\family default
sampling rate of the undecimated data 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nsets 0; 
\family default
number of sets (windows) for each decimation level 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nf 0; 
\family default
number of requencies for each decimation level 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.W [1 2]; 
\family default
index of first and last window for each decimaimation level 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.T [0 0 0]; 
\family default
central time of first window in seconds since reftime and time % spacing
 between adjacent windows for each decimation level 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.F [1 1 0]; 
\family default
first and last frequency
\end_layout

\begin_layout Subsection
\noindent
Dependent properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.sratedec 
\family default
Sampling rates for each decimation levels
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nfc total number of fourier coefficients for each decimation level
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Y
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Fourier coefficients of output channels at the given decimation level for
 the range of frequencies, sets and channels defined above.
 Invoking this dependent property triggers data reading from the file.
 The dimension of 
\family typewriter
Y
\family default
 is 
\family typewriter
[Nfc,Nsets,Nk,Noutputch]
\family default
.
 For one output channel and a single taper spectrum, this reduces to 
\family typewriter
[Nfc,Nsets]
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.maskY
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Logical mask for the same subset of coefficients, read from the fourier
 coefficient file.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.X
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Fourier coefficients of input channels.
 The dimension of 
\family typewriter
X
\family default
 is 
\family typewriter
[Nfc,Nsets,Nk,Ninputch]
\family default
.
 For one input channel and a single taper spectrum, this reduces to 
\family typewriter
[Nfc,Nsets]
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.maskX
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Logical mask for the same subset of coefficients, read from the fourier
 coefficient file.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.F
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Three-component vector containing the first and the last frequency (in
 Hz) of fourier coefficients as well as the spacing of frequencies for the
 current decimation level.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.f
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Vector of frequencies for the current decimation level (usedec) and the
 current frequency subset (fcrange)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.w
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Vector of of set indices relative to first set in file for current range
 of windows (setrange)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.wr
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Vector of of set indices relative to reftime the current range of windows
 (setrange)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.trs
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 central time of sets (time windows) for current selection of sets, relative
 to reftime, in seconds
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.trh
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 central time of sets (time windows) for current selection of sets, relative
 to reftime, in hours
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.trd
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 central time of sets (time windows) for current selection of sets, relative
 to reftime, in days
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.utc
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 central time of sets (time windows) for current selection of sets, in utc
 time; use datestr to convert to readable format
\end_layout

\begin_layout Subsection
\noindent
Methods
\end_layout

\begin_layout Standard
2do: move plotting functions into EMRobustProcesing
\end_layout

\begin_layout Standard
add plotting of power spectra
\end_layout

\begin_layout Standard
need to check time axis
\end_layout

\begin_layout Section
Class 
\family typewriter
EMRobustProcessing
\end_layout

\begin_layout Standard

\family typewriter
EMRobustProcessing
\family default
 performs multi-linear robust regression on fourier coefficients or spectra.
 
\end_layout

\begin_layout Standard

\series bold
2DO:
\series default
 at the moment, the first argument is the frequency vector.
 remove this.
 add time axis.
 These two vectors are only needed for plotting.
 
\end_layout

\begin_layout Subsection
Initializing the object
\end_layout

\begin_layout Standard
The object is initialized with the command
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMRobustProcessing(Y,X);
\end_layout

\begin_layout Standard
where 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
 are output and input channels of the linear system.
 Here, we understand that the values of 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
 are fourier coefficients, and that all values of 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
 are independent realizations of one random variable.
 In standard EM applications, we average over a range of frequencies to
 estimate the response function at one central (target frequency).
 Thus, the corresponding fourier coefficients can be averaged together.
 Useful band setup defintions are contained in the 
\family typewriter
bs
\family default
 property of an 
\family typewriter
EMSpectra
\family default
 object.
 
\end_layout

\begin_layout Standard
The data arrays 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
 are of dimension 
\family typewriter
[Nfc,Nsets,Nk,Nch]
\family default
, where 
\family typewriter
Nfc
\family default
 is the number of fourier coefficients, 
\family typewriter
Nsets
\family default
 the number of sets (time widnows in our application), 
\family typewriter
Nk
\family default
 the number of tapers (for multi-taper spectral estimations), and 
\family typewriter
Nch
\family default
 is the number of output and input channels, respectively.
 Hence the dimension of 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
 must be equal except for the number of channels, which can be different
 for the input and output.
 Note that it is only meaningful to combine synchronous sets (time windows).
 To combine multiple, overlapping recordings of the input and output channels
 (which is the standard for interstation transfer functions), the data must
 be synchronized (intersected) before.
\end_layout

\begin_layout Standard
A data mask can be provided during the initialization of the object.
 Let 
\family typewriter
useY
\family default
 and 
\family typewriter
useX
\family default
 be logical masks of the same dimension as 
\family typewriter
Y
\family default
 and 
\family typewriter
X
\family default
, respectively, the command 
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMRobustProcessing(Y,X,useY,uesX);
\end_layout

\begin_layout Standard
sets these fields.
 
\family typewriter
useY
\family default
 and 
\family typewriter
useX
\family default
 are public fields, i.e.
 these fields can be set also after intializing the object, with the commands
\end_layout

\begin_layout Standard

\family typewriter
>> obj.useY=useY;
\end_layout

\begin_layout Standard

\family typewriter
>> obj.useX=useX;
\end_layout

\begin_layout Standard
In addition to input and output channels, reference channels can be defined.
 The object is then initialized with the command
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMRobustProcessing(Y,X,Xr);
\end_layout

\begin_layout Standard
where 
\family typewriter
Xr
\family default
 are the corresponding data of the reference and which is the same dimension
 as 
\family typewriter
X
\family default
.
 A corresponding initialization that includes masks is
\end_layout

\begin_layout Standard

\family typewriter
>> obj = EMRobustProcessing(Y,X,Xr,useY,useX,useXr);
\end_layout

\begin_layout Standard
The class supports additional asming or selection schemes based on the coherency
 of the channels.
 These masks will be overlayed with the 
\family typewriter
use*
\family default
 mask with an logical 
\family typewriter
AND
\family default
.
 I.e., let the masking determined by some criteria be stored in, say, 
\family typewriter
maskY
\family default
, then only those realizations are used, for which 
\end_layout

\begin_layout Standard

\family typewriter
useY & maskY
\end_layout

\begin_layout Standard
is 
\family typewriter
TRUE
\family default
.
\end_layout

\begin_layout Standard
\noindent
Other properties that are set during the initialization of the object are
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nfc
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of fourier coefs.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nsets
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of sets
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nk
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of slepian sequences / or tapers
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Noutput
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of output channels
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Ninput
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of input channels
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.Nrefs
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 number of of reference channels
\end_layout

\begin_layout Standard
Although these fields are public, they are automatically initialized and
 should not be changed.
\end_layout

\begin_layout Subsection
Public properties
\end_layout

\begin_layout Standard
\noindent
Public properties are as follows:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.f
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 frequencies.
 Default is 
\family typewriter
f = []; 
\family default
(property is optional and only used for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.t
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 central times of sets (time windows) in seconds relative to the start of
 the first window.
 Default is 
\family typewriter
t = []; 
\family default
(property is optional and only used for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.input
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 cell array with names of input channels.
 Default is 
\family typewriter
input = {}; 
\family default
(property is optional and only used for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.output
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 cell array with names of output channels.
 .
 Default is 
\family typewriter
output = {}; 
\family default
(property is optional and only used for plotting)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Y
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 output channel data (see above)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.X
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 input channel data
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Xr
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 reference channel data
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.useY
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 predefined masking for output channels (see above)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.useX
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 predefined masking for input channels 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.useXr
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 predefined masking for reference channels 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.huber
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Huber constant for robust regression.
 Default is 
\family typewriter
huber=1.5;
\family default
 
\emph on
See Methods for details on the regression.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.reg
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Perform regression on fourier coefficients directly 
\family typewriter
'fc'
\family default
 or on spectra 
\family typewriter
'spectra'
\family default
.
 Default is 
\family typewriter
reg='fc'; 
\family default
\emph on
See Methods for details on the regression.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.smooth
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Method for spectral smoothing.
 Default is
\family typewriter
 smooth='runav';
\family default
 Options are 
\family typewriter

\begin_inset Newline newline
\end_inset

'none'
\family default
 no smoothing
\begin_inset Newline newline
\end_inset


\family typewriter
'smoothn'
\family default
 uses the smoothing function 
\family typewriter
smoothn
\family default
 from Garcia, 2010; it requires the 
\emph on
MATLAB Image Toolbox
\emph default
.
 The 
\family typewriter
smoothn
\family default
 method interpretes the 
\family typewriter
avrange
\family default
 as the preset smoothing factor.
 If 
\family typewriter
avrange = []
\family default
, the smoothing factor is to be determined automatically.
 Type 
\family typewriter
>> help smoothn
\family default
 for details and more options.
 May be very slow for large data sets.
\begin_inset Newline newline
\end_inset


\family typewriter
'runav'
\family default
 (2D running average)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent

\family typewriter
obj.avrange
\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\family default
 Averaging domain / smoothing factor for smoothing of spectra.
 Default is 
\family typewriter
avrange=[2 5]
\family default
 and is valid for the 
\family typewriter
runav
\family default
 option
\family typewriter
.
 
\family default
For this option, the vector contains the number of adjacent fourier coefficients
 and sets (time windows) which are being averaged to smooth the spectra.
 For the 
\family typewriter
smoothn
\family default
 option, 
\family typewriter
avrange
\family default
 is a single number, which is interpreted as the smoothing factor for 
\family typewriter
smoothn
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bicohthresg {[min max],[],...}
\family default
 Global bivariate coherency thresholds, applied to individual pixels of
 the
\family typewriter
 Nfc x Nsets
\family default
 bivariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bicohthresf {[min max],[],...}
\family default
 Noutput global bivariate coherency thresholds, applied to time averaged
 coherencies to pull out individual frequencies of the
\family typewriter
 Nfc x Nsets
\family default
 bivariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bicohthrest {[min max],[],...}
\family default
 Noutput global bivariate coherency thresholds, applied to frequency-averaged
 coherencies to pull out individual sets (time windows) of the
\family typewriter
 Nfc x Nsets
\family default
 bivariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.unicohthresg {[min max],[],...}
\family default
 Noutput global univariate coherency thresholds, applied to individual pixels
 of the
\family typewriter
 Nfc x Nsets
\family default
 univariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.unicohthresf {[min max],[],...}
\family default
 Noutput global univariate coherency thresholds, applied to time-averaged
 coherencies to pull out individual frequencies of the
\family typewriter
 Nfc x Nsets
\family default
 univariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.unicohthrest {[min max],[],...}
\family default
 Noutput global univariate coherency thresholds, applied to frequwncy-averaged
 coherencies to pull out individual sets (time windows) of the
\family typewriter
 Nfc x Nsets
\family default
 univariate coherency image.
 Minimum and maximum coherencies are defined separately for each channel
 of the output channels.
 Default is empty; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tfthres {[zr+1i*zi, radius, iinput],[],...} 
\family default
include points within cirle drawn by radius around point zr+1i*zi in the
 complex plane.
 iinput indexes the input channel, i.e.
 let the two output channels be Ex and Ey, then Zyx is masked with the following
 syntax
\family typewriter
 {[],[zr+1i*zi, radius, 1],
\family default
 where 1 refers to Hx
\family typewriter
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.debuglevel
\begin_inset space ~
\end_inset


\family default
 Output some debugging information.
 Default value is 1.
\end_layout

\begin_layout Subsection
Dependent Properties
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.maskY
\family default
 logical mask for otput channels, made dependent on above thresholds.
 
\family typewriter
maskY
\family default
 is overlaid with 
\family typewriter
useY
\family default
 (with logical 
\family typewriter
AND
\family default
: 
\family typewriter
maskY = maskY & useY)
\family default
.
 Note that for mathematical operations, 
\family typewriter
maskY
\family default
 must be converted to double precision, e.g.
 by 
\family typewriter
maskY*1.0
\family default
.
 Dimension of 
\family typewriter
maskY
\family default
 is the same as the dimension of 
\family typewriter
Y.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.maskX
\family default
 same as bove, but for input channels 
\family typewriter
X
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.maskXr
\family default
 same as bove, but for reference channels 
\family typewriter
X
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Ym
\family default
 
\family typewriter
Y
\family default
 with masked entries in 
\family typewriter
maskY
\family default
 set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Xm
\family default
 
\family typewriter
X
\family default
 with masked entries in 
\family typewriter
maskX
\family default
 set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.Xrm
\family default
 
\family typewriter
Xr
\family default
 with masked entries in 
\family typewriter
maskXr
\family default
 set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YmN
\family default
 
\family typewriter
Ym
\family default
, reshaped to 
\family typewriter
N x Noutput
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XmN
\family default
 
\family typewriter
Ym
\family default
, reshaped to 
\family typewriter
N x Ninput
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XrmN
\family default
 
\family typewriter
Ym
\family default
, reshaped to 
\family typewriter
N x Nrefs
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YY
\family default
 Spectral matrix of output channels 
\family typewriter
Y.

\family default
 For 
\family typewriter
Noutput=1
\family default
, this reduces to 
\family typewriter
Y.*conj(Y).

\family default
 For multiple output channels, the spectral matrix is computed as follows.
 Let 
\begin_inset Formula $\mathbf{Y}_{1,\,...,N}$
\end_inset

 be the 
\begin_inset Formula $N$
\end_inset

 channels, then the spectral matrix is given by 
\begin_inset Formula 
\[
\mathbf{Y}\mathbf{Y}^{*}=\left[\begin{array}{cccc}
\mathbf{Y}_{1}\mathbf{Y}_{1}^{*} & \mathbf{Y}_{1}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{Y}_{1}\mathbf{Y}_{N}^{*}\\
\mathbf{Y}_{2}\mathbf{Y}_{1}^{*} & \mathbf{Y}_{2}\mathbf{Y}_{2}^{*}\\
\vdots &  & \ddots\\
\mathbf{Y}_{N}\mathbf{Y}_{1}^{*} &  &  & \mathbf{Y}_{N}\mathbf{Y}_{N}^{*}
\end{array}\right]\,\,\,.
\]

\end_inset

and stored in the four-dimensional array 
\family typewriter
YY
\family default
 with dimensions 
\family typewriter
Nfc x Nsets x Nk x Noutput^2
\family default
, where the order of storage for the last dimension is row-wise:
\begin_inset Formula 
\[
\mathbf{Y}\mathbf{Y}^{*}=\left[\begin{array}{cccccccccc}
\mathbf{Y}_{1}\mathbf{Y}_{1}^{*} & \mathbf{Y}_{1}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{Y}_{1}\mathbf{Y}_{N}^{*} & \mathbf{Y}_{2}\mathbf{Y}_{1}^{*} & \mathbf{Y}_{2}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{Y}_{N}\mathbf{Y}_{1}^{*} & \cdots & \mathbf{Y}_{N}\mathbf{Y}_{N}^{*}\end{array}\right]\,\,\,.
\]

\end_inset

The spectral combination 
\begin_inset Formula $\mathbf{Y}_{i}\mathbf{Y}_{j}^{*}$
\end_inset

 of channels 
\begin_inset Formula $i,\, j$
\end_inset

 are thus indexed in the fourth dimension with 
\family typewriter
j + (i-1) x Noutput
\family default
, and in particular for the autopowers 
\begin_inset Formula $\mathbf{Y}_{i}\mathbf{Y}_{i}^{*}$
\end_inset

, the index reads 
\family typewriter
i + (i-1) x Noutput.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XX
\family default
 Spectral matrix of input channels 
\family typewriter
X
\family default
.
 Otherwise same as for 
\family typewriter
YY.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXr
\family default
 Spectral matrix of input channels 
\family typewriter
Xr
\family default
.
 Otherwise same as for 
\family typewriter
XX.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YX
\family default
 Cross-spectral matrix between output channels 
\family typewriter
Y
\family default
 and input channels 
\family typewriter
X.

\family default
 For 
\family typewriter
Noutput=1
\family default
 and 
\family typewriter
Ninput=1,
\family default
 this reduces to 
\family typewriter
Y.*conj(X).

\family default
 For multiple output and input channels, the spectral matrix is computed
 as follows.
 Let 
\begin_inset Formula $\mathbf{Y}_{1,\,...,N}$
\end_inset

 be the 
\begin_inset Formula $N$
\end_inset

 output channels and 
\begin_inset Formula $\mathbf{X}_{1,\,...,M}$
\end_inset

 be the 
\begin_inset Formula $M$
\end_inset

 input channels , then the 
\begin_inset Formula $N\times M$
\end_inset

 cross-spectral matrix is given by 
\begin_inset Formula 
\[
\mathbf{Y}\mathbf{X}^{*}=\left[\begin{array}{cccc}
\mathbf{Y}_{1}\mathbf{X}_{1}^{*} & \mathbf{Y}_{1}\mathbf{X}_{2}^{*} & \cdots & \mathbf{Y}_{1}\mathbf{X}_{M}^{*}\\
\mathbf{Y}_{2}\mathbf{X}_{1}^{*} & \mathbf{Y}_{2}\mathbf{X}_{2}^{*}\\
\vdots &  & \ddots\\
\mathbf{Y}_{N}\mathbf{X}_{1}^{*} &  &  & \mathbf{Y}_{N}\mathbf{X}_{M}^{*}
\end{array}\right]\,\,\,.
\]

\end_inset

and stored in the four-dimensional array 
\family typewriter
YX
\family default
 with dimensions 
\family typewriter
Nfc x Nsets x Nk x (Noutput
\family default
 
\family typewriter
x Ninput)
\family default
, where the order of storage for the last dimension is row-wise:
\begin_inset Formula 
\[
\mathbf{Y}\mathbf{X}^{*}=\left[\begin{array}{cccccccccc}
\mathbf{Y}_{1}\mathbf{X}_{1}^{*} & \mathbf{Y}_{1}\mathbf{X}_{2}^{*} & \cdots & \mathbf{Y}_{1}\mathbf{X}_{M}^{*} & \mathbf{Y}_{2}\mathbf{X}_{1}^{*} & \mathbf{Y}_{2}\mathbf{X}_{2}^{*} & \cdots & \mathbf{Y}_{N}\mathbf{X}_{1}^{*} & \cdots & \mathbf{Y}_{N}\mathbf{X}_{M}^{*}\end{array}\right]\,\,\,.
\]

\end_inset

The spectral combination 
\begin_inset Formula $\mathbf{Y}_{i}\mathbf{X}_{j}^{*}$
\end_inset

 of channels 
\begin_inset Formula $i,\, j$
\end_inset

 are thus indexed in the fourth dimension with 
\family typewriter
j + (i-1) x Noutput.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XY
\family default
 Cross-spectral matrix between input channels 
\family typewriter
X
\family default
 and output channels 
\family typewriter
Y.

\family default
 For 
\family typewriter
Ninput=1
\family default
 and 
\family typewriter
output=1,
\family default
 this reduces to 
\family typewriter
X.*conj(Y).

\family default
 For multiple input and output channels, the spectral matrix is computed
 as follows.
 Let 
\begin_inset Formula $\mathbf{X}_{1,\,...,M}$
\end_inset

 be the 
\begin_inset Formula $M$
\end_inset

 input channels and 
\begin_inset Formula $\mathbf{Y}_{1,\,...,N}$
\end_inset

 be the 
\begin_inset Formula $N$
\end_inset

 output channels , then the 
\begin_inset Formula $M\times N$
\end_inset

 cross-spectral matrix is given by 
\begin_inset Formula 
\[
\mathbf{X}\mathbf{Y}^{*}=\left[\begin{array}{cccc}
\mathbf{X}_{1}\mathbf{Y}_{1}^{*} & \mathbf{X}_{1}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{X}_{1}\mathbf{Y}_{N}^{*}\\
\mathbf{X}_{2}\mathbf{Y}_{1}^{*} & \mathbf{X}_{2}\mathbf{Y}_{2}^{*}\\
\vdots &  & \ddots\\
\mathbf{X}_{M}\mathbf{Y}_{1}^{*} &  &  & \mathbf{X}_{M}\mathbf{Y}_{N}^{*}
\end{array}\right]\,\,\,.
\]

\end_inset

and stored in the four-dimensional array 
\family typewriter
YX
\family default
 with dimensions 
\family typewriter
Nfc x Nsets x Nk x (Ninput
\family default
 
\family typewriter
x Noutput)
\family default
, where the order of storage for the last dimension is row-wise:
\begin_inset Formula 
\[
\mathbf{X}\mathbf{Y}^{*}=\left[\begin{array}{cccccccccc}
\mathbf{X}_{1}\mathbf{Y}_{1}^{*} & \mathbf{X}_{1}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{X}_{1}\mathbf{Y}_{N}^{*} & \mathbf{X}_{2}\mathbf{Y}_{1}^{*} & \mathbf{X}_{2}\mathbf{Y}_{2}^{*} & \cdots & \mathbf{X}_{M}\mathbf{Y}_{1}^{*} & \cdots & \mathbf{X}_{M}\mathbf{Y}_{N}^{*}\end{array}\right]\,\,\,.
\]

\end_inset

The spectral combination 
\begin_inset Formula $\mathbf{X}_{i}\mathbf{Y}_{j}^{*}$
\end_inset

 of channels 
\begin_inset Formula $i,\, j$
\end_inset

 are thus indexed in the fourth dimension with 
\family typewriter
j + (i-1) x Ninput.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YYs
\family default
 smoothed version of spectral matrix 
\family typewriter
YY
\family default
.
 Smoothing options are set in the properties 
\family typewriter
obj.smooth
\family default
 and 
\family typewriter
obj.avrange.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXs
\family default
 smoothed version of spectral matrix 
\family typewriter
XX
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXrs
\family default
 smoothed version of spectral matrix 
\family typewriter
XXr
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YXs
\family default
 smoothed version of spectral matrix 
\family typewriter
YX
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XYs
\family default
 smoothed version of spectral matrix 
\family typewriter
XY
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YYm
\family default
 smoothed version of spectral matrix 
\family typewriter
YY
\family default
s with masked data set to 
\family typewriter
NAN.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXm
\family default
 smoothed version of spectral matrix 
\family typewriter
XX
\family default
s with masked data set to 
\family typewriter
NAN.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXrm
\family default
 smoothed version of spectral matrix 
\family typewriter
XXr
\family default
s with masked data set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YXm
\family default
 smoothed version of spectral matrix 
\family typewriter
YX
\family default
s with masked data set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XYm
\family default
 smoothed version of spectral matrix 
\family typewriter
XY
\family default
s with masked data set to 
\family typewriter
NAN
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YYmN
\family default
 
\family typewriter
YYm
\family default
 reshaped to 
\family typewriter
N x (Noutput x Noutput)
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXmN
\family default
 
\family typewriter
XXm
\family default
 reshaped to 
\family typewriter
N x (Ninput x Ninput)
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XXrmN
\family default
 
\family typewriter
XXrm
\family default
 reshaped to 
\family typewriter
N x (Ninput x Ninput)
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.YXmN
\family default
 
\family typewriter
YXm
\family default
 reshaped to 
\family typewriter
N x (Noutput x Ninput)
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.XYmN
\family default
 
\family typewriter
XYm
\family default
 reshaped to 
\family typewriter
N x (Ninput x Noutput)
\family default
 matrix, with 
\family typewriter
N = Nfc x Nsets x Nk
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.unicoh
\family default
 univariate coherencies; only available for 
\family typewriter
Ninput = Noutput = 1.
 
\family default
\series bold
\emph on
Must be generalized!
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.bicoh
\family default
 variate coherencies only available for
\family typewriter
 Ninput = 2;
\family default
 Dimension of 
\family typewriter
bicoh 
\family default
is
\family typewriter
 Nfc x Nsets 
\family default
for
\family typewriter
 Noutput = 1 
\family default
and
\family typewriter
 Nfc x Nsets x Noutput
\family default
, where the order of the third dimension corresponds to the order of the
 output channels.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.tfs
\family default
 lsq transfer functions for each estimate of the smoothed spectra 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.leverage
\family default
 
\series bold
\emph on
not yet implemented;
\series default
\emph default
 should come along with 
\family typewriter
tfs
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
obj.resid
\family default
 
\series bold
\emph on
not yet implemented;
\series default
 
\emph default
should come along with 
\family typewriter
tfs
\family default
.
\end_layout

\begin_layout Subsection
\noindent
Methods
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
[Z,Zse]
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

computetf(obj); 
\family default
Robust transfer function estimation.
 
\begin_inset Newline newline
\end_inset


\family typewriter
reg = 'fc'
\family default
; The function performs a robust M-estimate of transfer functions an iterative
 least squares 
\series bold
\emph on
Must be generalized!
\begin_inset Newline newline
\end_inset


\family typewriter
\series default
\emph default
reg = 'spectra';
\end_layout

\begin_layout Section
Format of 
\family typewriter
*.mtd/*.txt
\family default
 files
\end_layout

\begin_layout Section
Format of 
\family typewriter
*.ats
\family default
 files
\end_layout

\begin_layout Section
Format of 
\family typewriter
*.afc
\family default
 files
\end_layout

\begin_layout Standard
Fourier coefficients for multiple channels and multiple decimation levels
 are stored in a common binary 
\family typewriter
*.afc
\family default
 file.
 The file is organized in header sections and data blocks.
 A global header contains information about the station, the number of channels
 and the decimation scheme, and channel headers conatin channel-specific
 information.
 The format is as follows:
\end_layout

\begin_layout Standard
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Global
\begin_inset space ~
\end_inset

header
\family default
 starts at bof; length of this header is the first number in file
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
global_headerlength 
\family default
length of global header
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
channel_headerlength
\family default
 length of channel header
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
Nch
\family default
, number of channels 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 sampling rate
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 
\family typewriter
reftime
\family default
 of survey, use 
\family typewriter
datevec
\family default
 to convert 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
Ndec
\family default
, number of decimation levels
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Ndec
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
decimate
\family default
, decimation factors
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Ndec
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
wlength
\family default
, window lengths in number of samples
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Ndec
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
noverlap
\family default
, overlap of adjacent windows in number of samples
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Ndec
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
prew
\family default
, prewhitening option
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
4
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 window type, can be 
\family typewriter
'hann', 'hamm', 'dpss'
\family default
 , 'rect'
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
Nk
\family default
, number of tapers
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
timebandwidth
\family default
, for dpss windows
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 delay filter frequency
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
Ndnts
\family default
 number of characters in diecrtiry name of time series
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
\noindent
\align block

\family typewriter
Ndnts
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 
\family typewriter
tssource
\family default
 directory name of time series
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
The
\begin_inset space ~
\end_inset

following
\begin_inset space ~
\end_inset

block
\begin_inset space ~
\end_inset


\family typewriter
Ndec
\family default

\begin_inset space ~
\end_inset

times,
\begin_inset space ~
\end_inset

one
\begin_inset space ~
\end_inset

for
\begin_inset space ~
\end_inset

each
\begin_inset space ~
\end_inset

decimation
\begin_inset space ~
\end_inset

level: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
for
\begin_inset space ~
\end_inset

idec
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

1:Ndec
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
3
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int32
\family default
 
\family typewriter
[Nfc Nsets Nk]
\family default
 size of data in the current decimation level
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
2
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int32
\family default
 
\family typewriter
[W1 WN]
\family default
 window ids of first and last window with respect to reftime;
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
3
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 
\family typewriter
[T1 TN dT]
\family default
 central time of first window in seconds since reftime, central time of
 last window in seconds since reftime, and time interval between to adjacent
 windows
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
3
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 
\family typewriter
[F1 FN dF]
\family default
 frequency of first fourier coefficient, frequency of last fourier coefficient,
 frequency increment 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
end
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
<reserved>
\family default
 
\end_layout

\begin_layout Standard
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
channel
\begin_inset space ~
\end_inset

1
\family default
 starts at 
\family typewriter
global_headerlength+1
\family default
 bytes; 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
2
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 channel name of 1st channel, e.g.
 
\family typewriter
'Ex'
\family default
, ...
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
2
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 channel type, e.g.
 
\family typewriter
'Ex'
\family default
, ...
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
<reserved>
\family default
 
\end_layout

\begin_layout Standard
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "0.5pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
data
\begin_inset space ~
\end_inset

block
\begin_inset space ~
\end_inset

for
\begin_inset space ~
\end_inset

channel
\begin_inset space ~
\end_inset

1
\family default
 starts at 
\family typewriter
global_headerlength+global_headerlength+1
\family default
 bytes; the folllowing block is repeated for each decimation level, and
 if there are more than one taper (i.e.
 multi-taper spectra), the data block containing the fourier coefficients
 is repeated for each taper.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
for
\begin_inset space ~
\end_inset

idec
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

1:Ndec
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
for
\begin_inset space ~
\end_inset

ik
\begin_inset space ~
\end_inset

=
\begin_inset space ~
\end_inset

1:Nk
\family default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Nfc
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

Nsets
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32 
\family default
real part of fourier coefficients at level 
\family typewriter
idec
\family default
 and for taper 
\family typewriter
ik
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Nfc
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

Nsets
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

float32
\family default
 imaginary part of fourier coefficients 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
end
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Nfc
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

Nsets
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

uint8
\family default
 binary mask 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
\emph on
end
\end_layout

\begin_layout Standard
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "1pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
channel
\begin_inset space ~
\end_inset

ich
\family default
 starts at 
\family typewriter
global_headerlength+(ich-1)*channel_headerlength+(ich-1)*Nfc*9+1
\family default
 bytes; 
\begin_inset Newline newline
\end_inset


\family typewriter
Nfc
\family default
 is the total number of Fcs, summed over all decimation levels 
\family typewriter
Ndec
\family default
.
 This number multiplies by 
\family typewriter
9 byte
\family default
, four for each real and imaginary part and 
\family typewriter
1 byte
\family default
 for a binary mask 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
2
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 channel name of 2nd channel, e.g.
 
\family typewriter
'Ey'
\family default
, ...
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
2
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1
\family default
 channel type, e.g.
 
\family typewriter
'Ey'
\family default
, ...
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
1
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

int16
\family default
 
\family typewriter
Nfn,
\family default
 length of file name of time series
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
Nfn
\begin_inset space ~
\end_inset

x
\begin_inset space ~
\end_inset

char*1 
\family default
filename of time series
\end_layout

\begin_layout Standard
\begin_inset CommandInset line
LatexCommand rule
offset "0.5ex"
width "100col%"
height "0.5pt"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000

\family typewriter
data
\begin_inset space ~
\end_inset

block
\begin_inset space ~
\end_inset

for
\begin_inset space ~
\end_inset

channel
\begin_inset space ~
\end_inset

ic
\family default
 starts at 
\family typewriter
global_headerlength+ich*channel_headerlength+ (ich-1)*(Nfc*8+Nfc/kd)
\family default
 bytes;
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000000000000
...
\end_layout

\begin_layout Standard

\series bold
References:
\end_layout

\begin_layout Standard
Garcia, D., 
\series bold
2010
\series default
.
 Robust smoothing of gridded data in one and higher dimensions with missing
 values.
 Computational Statistics & Data Analysis.
 
\emph on
http://www.biomecardio.com/pageshtm/publi/csda10.pdf
\end_layout

\end_body
\end_document
